<!DOCTYPE html>
<html lang="en"><head>
<script src="lec3_files/libs/clipboard/clipboard.min.js"></script>
<script src="lec3_files/libs/quarto-html/tabby.min.js"></script>
<script src="lec3_files/libs/quarto-html/popper.min.js"></script>
<script src="lec3_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="lec3_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="lec3_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="lec3_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="lec3_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.4.322">

  <meta name="author" content="Christopher Cahill">
  <meta name="dcterms.date" content="2023-09-06">
  <title>An introduction to Stan for applied Bayesian inference</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="lec3_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="lec3_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        background-color: #ffffff;
        color: #a0a0a0;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #a0a0a0;  padding-left: 4px; }
    div.sourceCode
      { color: #1f1c1b; background-color: #ffffff; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #1f1c1b; } /* Normal */
    code span.al { color: #bf0303; background-color: #f7e6e6; font-weight: bold; } /* Alert */
    code span.an { color: #ca60ca; } /* Annotation */
    code span.at { color: #0057ae; } /* Attribute */
    code span.bn { color: #b08000; } /* BaseN */
    code span.bu { color: #644a9b; font-weight: bold; } /* BuiltIn */
    code span.cf { color: #1f1c1b; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #924c9d; } /* Char */
    code span.cn { color: #aa5500; } /* Constant */
    code span.co { color: #898887; } /* Comment */
    code span.cv { color: #0095ff; } /* CommentVar */
    code span.do { color: #607880; } /* Documentation */
    code span.dt { color: #0057ae; } /* DataType */
    code span.dv { color: #b08000; } /* DecVal */
    code span.er { color: #bf0303; text-decoration: underline; } /* Error */
    code span.ex { color: #0095ff; font-weight: bold; } /* Extension */
    code span.fl { color: #b08000; } /* Float */
    code span.fu { color: #644a9b; } /* Function */
    code span.im { color: #ff5500; } /* Import */
    code span.in { color: #b08000; } /* Information */
    code span.kw { color: #1f1c1b; font-weight: bold; } /* Keyword */
    code span.op { color: #1f1c1b; } /* Operator */
    code span.ot { color: #006e28; } /* Other */
    code span.pp { color: #006e28; } /* Preprocessor */
    code span.re { color: #0057ae; background-color: #e0e9f8; } /* RegionMarker */
    code span.sc { color: #3daee9; } /* SpecialChar */
    code span.ss { color: #ff5500; } /* SpecialString */
    code span.st { color: #bf0303; } /* String */
    code span.va { color: #0057ae; } /* Variable */
    code span.vs { color: #bf0303; } /* VerbatimString */
    code span.wa { color: #bf0303; } /* Warning */
  </style>
  <link rel="stylesheet" href="lec3_files/libs/revealjs/dist/theme/quarto.css">
  <link rel="stylesheet" href="https://qfcatmsu.github.io/css/presStyle.css">
  <link href="lec3_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="lec3_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="lec3_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="lec3_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    padding-bottom: 0.5rem;
    margin-bottom: 0;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-image="https://qfcatmsu.github.io/Images/dark-big.png" data-background-position="6% 95%" data-background-size="40%" class="quarto-title-block center">
  <h1 class="title">An introduction to Stan for applied Bayesian inference</h1>
  <p class="subtitle">FW 891</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Christopher Cahill 
</div>
</div>
</div>

  <p class="date">6 September 2023</p>
</section>
<section id="purpose" class="slide level2">
<h2>Purpose</h2>
<ul>
<li>Learn the basic syntax of the Stan language</li>
<li>Write code to elicit simple models and implement Bayesian inference in Stan</li>
<li>Use the cmdstanr interface</li>
<li>Develop familiarity with a few packages that make your life easier</li>
<li>Walk through some model diagnostics</li>
<li>Make sure you have these programs/packages installed<br>
<img data-src="images/Rlogo.png" style="width:185px; position: absolute; margin-top:1.5%; left:0%;"> <img data-src="images/logo_website.png" style="width:150px; position: absolute; margin-top:1%; right:66%;"> <img data-src="images/tidyverse.png" style="width:165px; position: absolute; margin-top:0.5%; right:47%;"> <img data-src="images/tidybayes.png" style="width:185px; position: absolute; margin-top:0%; right:28%;"></li>
</ul>
</section>
<section id="installing-cmdstanr" class="slide level2">
<h2>Installing CmdStanR</h2>
<ul>
<li>See the <a href="https://mc-stan.org/cmdstanr/">installation instructions here</a></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(cmdstanr)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="co"># use a built in file that comes with cmdstanr:</span></span>
<span id="cb1-3"><a href="#cb1-3"></a>file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(</span>
<span id="cb1-4"><a href="#cb1-4"></a>  <span class="fu">cmdstan_path</span>(), <span class="st">"examples"</span>,</span>
<span id="cb1-5"><a href="#cb1-5"></a>  <span class="st">"bernoulli"</span>, <span class="st">"bernoulli.stan"</span></span>
<span id="cb1-6"><a href="#cb1-6"></a>)</span>
<span id="cb1-7"><a href="#cb1-7"></a>mod <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(file)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>see also <a href="https://mc-stan.org/docs/cmdstan-guide/index.html">CmdStan user’s guide</a></p>
</section>
<section id="now-lets-make-sure-it-works" class="slide level2">
<h2>Now let’s make sure it works</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># tagged list where names correspond to the .stan data block</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>stan_data <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">N =</span> <span class="dv">10</span>, <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb2-3"><a href="#cb2-3"></a></span>
<span id="cb2-4"><a href="#cb2-4"></a>fit <span class="ot">&lt;-</span> mod<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb2-5"><a href="#cb2-5"></a>  <span class="at">data =</span> stan_data,</span>
<span id="cb2-6"><a href="#cb2-6"></a>  <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb2-7"><a href="#cb2-7"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb2-8"><a href="#cb2-8"></a>  <span class="at">parallel_chains =</span> <span class="dv">4</span>,</span>
<span id="cb2-9"><a href="#cb2-9"></a>  <span class="at">refresh =</span> <span class="dv">500</span> <span class="co"># print update every 500 iters</span></span>
<span id="cb2-10"><a href="#cb2-10"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="do-the-bottom-numbers-match-up" class="slide level2">
<h2>Do the bottom numbers match up?</h2>
<div class="cell" style="font-size: 19.5pt;">
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 parallel chains...

Chain 1 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 1 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 1 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 2 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 2 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 2 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 3 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 3 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 3 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 4 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 4 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 4 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 1 finished in 0.1 seconds.
Chain 2 finished in 0.1 seconds.
Chain 3 finished in 0.1 seconds.
Chain 4 finished in 0.1 seconds.

All 4 chains finished successfully.
Mean chain execution time: 0.1 seconds.
Total execution time: 0.6 seconds.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>fit<span class="sc">$</span><span class="fu">summary</span>() <span class="co"># you should get these numbers:</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 10
  variable   mean median    sd   mad      q5    q95  rhat ess_bulk ess_tail
  &lt;chr&gt;     &lt;num&gt;  &lt;num&gt; &lt;num&gt; &lt;num&gt;   &lt;num&gt;  &lt;num&gt; &lt;num&gt;    &lt;num&gt;    &lt;num&gt;
1 lp__     -7.26  -6.99  0.719 0.329 -8.73   -6.75   1.00    1658.    1861.
2 theta     0.246  0.231 0.118 0.118  0.0811  0.463  1.00    1378.    1236.</code></pre>
</div>
</div>
</section>
<section id="presumably-this-broke-someone" class="slide level2">
<h2>Presumably this broke someone</h2>

<img data-src="images/depression.png" style="width:150px; position: absolute; margin-top:-5%; right:1%;z-index:-1;" class="r-stretch"><p><span class="footerLeft"><a href="https://www.youtube.com/watch?v=f1R0qLh61Yw">image credit</a></span></p>
</section>
<section id="onward" class="slide level2">
<h2>Onward!</h2>
<h3 id="stan-the-basics">Stan: the basics</h3>
<p>Stan is a probablistic modeling language <a href="https://mc-stan.org/" class="uri">https://mc-stan.org/</a></p>
<ul>
<li><p>Freely available</p></li>
<li><p>Implements HMC, and an algorithm called NUTS</p>
<ul>
<li>No U-Turn Sampler</li>
<li>We are using it for full Bayesian inference, but it can do other things too (we will not talk about these things)</li>
</ul></li>
<li><p>The Stan <a href="https://mc-stan.org/users/documentation/">documentation</a> and <a href="https://discourse.mc-stan.org/">community</a> is legendary in my opinion, albeit dense at times</p></li>
</ul>
</section>
<section id="using-stan-requires-writing-a-.stan-file" class="slide level2">
<h2>Using Stan requires writing a <code>.stan</code> file</h2>
<ul>
<li><p>Coding in Stan is something of a cross between R, WINBUGS/JAGS, and C++</p></li>
<li><p>It is a Turing complete programming language</p></li>
<li><p>Stan requires you to be explicit</p>
<ul>
<li>Need to tell it whether something is a real, integer, vector, matrix, array, etc.</li>
<li>Lines need to end in a <code>;</code></li>
</ul></li>
<li><p>A <code>.stan</code> file relies on program blocks to read in your data and contruct your model</p></li>
<li><p>Many built in functions you can use</p></li>
<li><p>Why must we confront misery of a new language?</p></li>
</ul>
</section>
<section id="a-linear-regression-in-stan" class="slide level2">
<h2>A linear regression in Stan</h2>
<div style="font-size: 85%;">
<p>Let’s build a linear regression model, which can be written a few ways:</p>
<p><span class="math display">\[
y_{i}=\beta_{0}+\beta x_{i}+\epsilon_{i} \quad \text{where} \quad \epsilon_{i} \sim \operatorname{normal}(0, \sigma) \text {. }
\]</span></p>
<p>which is the same as</p>
<p><span class="math display">\[
y_{i}-\left(\beta_{0}+\beta X_{i}\right) \sim \operatorname{normal}(0, \sigma)
\]</span></p>
<p>and reducing further:</p>
<p><span class="math display">\[
y_{i} \sim \operatorname{normal}\left(\beta_{0}+\beta X_{i}, \sigma\right) .
\]</span></p>
</div>
</section>
<section id="linear-regression-in-stan-contd" class="slide level2">
<h2>Linear regression in Stan cont’d</h2>
<ul>
<li>Let’s build a simple linear regression model in Stan</li>
</ul>
<p><a href="https://github.com/QFCatMSU/FW-Bayes/blob/main/week2/data/linreg.rds?raw=true">The data</a></p>
<ul>
<li>What do we do when we get some data?</li>
</ul>
</section>
<section id="always-plot-the-data" class="slide level2">
<h2><span style="text-decoration: underline;">Always</span> plot the data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="fu">library</span>(ggqfc)</span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="fu">library</span>(cmdstanr)</span>
<span id="cb6-5"><a href="#cb6-5"></a></span>
<span id="cb6-6"><a href="#cb6-6"></a>data <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/linreg.rds"</span>)</span>
<span id="cb6-7"><a href="#cb6-7"></a>p <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> y, <span class="at">x =</span> x)) <span class="sc">+</span></span>
<span id="cb6-8"><a href="#cb6-8"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb6-9"><a href="#cb6-9"></a>  <span class="fu">theme_qfc</span>() <span class="sc">+</span></span>
<span id="cb6-10"><a href="#cb6-10"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>))</span>
<span id="cb6-11"><a href="#cb6-11"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="lec3_files/figure-revealjs/unnamed-chunk-6-1.png" width="960" class="r-stretch"></section>
<section id="always-plot-the-data-1" class="slide level2">
<h2><span style="text-decoration: underline;">Always</span> plot the data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>p <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">method =</span> lm, <span class="at">se =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="fu">lm</span>(data<span class="sc">$</span>y <span class="sc">~</span> data<span class="sc">$</span>x) <span class="co"># fit y = a + bx + e, where e ~ N(0, sd)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = data$y ~ data$x)

Coefficients:
(Intercept)       data$x  
     2.2559       0.6979  </code></pre>
</div>
</div>
<img data-src="lec3_files/figure-revealjs/unnamed-chunk-7-1.png" width="960" class="r-stretch"></section>
<section id="thinking-through-our-model" class="slide level2">
<h2><em>Thinking</em> through our model</h2>
<p><span class="math display">\[
\color{darkorange}{y_{i}} \sim \operatorname{normal}\left(\color{#8D44AD}{\beta_{0}}+\color{#8D44AD}{\beta X_{i}}, \color{#3697DC}{\sigma}\right).
\]</span></p>
<p><span style="color:darkorange;">response</span> = <span style="color:#8D44AD;">deterministic component</span> + <span style="color:#3697DC;">random component</span></p>
</section>
<section id="thinking-through-our-model-1" class="slide level2">
<h2><em>Thinking</em> through our model</h2>
<p><span class="math display">\[
\color{darkorange}{y_{i}} \sim \operatorname{normal}\left(\color{#8D44AD}{\beta_{0}}+\color{#8D44AD}{\beta X_{i}}, \color{#3697DC}{\sigma}\right).
\]</span></p>
<p><span style="color:darkorange;">response</span> = <span style="color:#8D44AD;">deterministic component</span> + <span style="color:#3697DC;">random component</span></p>
<p><span class="math inline">\(\text { If } \mu_{i} \in \mathbb{R} \text { and } \sigma \in \mathbb{R}^{+} \text {, then for } y_{i} \in \mathbb{R} \text {, }\)</span></p>
<p><span class="math display">\[
\operatorname{Normal}(y_{i} \mid \mu_{i}, \sigma)=\frac{1}{\sqrt{2 \pi} \sigma} \exp \left(-\frac{1}{2}\left(\frac{y_{i}-\mu_{i}}{\sigma}\right)^{2}\right)
\]</span></p>
</section>
<section id="thinking-through-our-model-2" class="slide level2">
<h2><em>Thinking</em> through our model</h2>
<p><span class="math display">\[
\color{darkorange}{y_{i}} \sim \operatorname{normal}\left(\color{#8D44AD}{\beta_{0}+\beta X_{i}}, \color{#3697DC}{\sigma}\right).
\]</span></p>
<p><span style="color:darkorange;">response</span> = <span style="color:#8D44AD;">deterministic component</span> + <span style="color:#3697DC;">random component</span></p>
<p><span class="math inline">\(\text { If } \mu_{i} \in \mathbb{R} \text { and } \sigma \in \mathbb{R}^{+} \text {, then for } y_{i} \in \mathbb{R} \text {, }\)</span></p>
<p><span class="math display">\[
\operatorname{Normal}(y_{i} \mid \color{#8D44AD}{\mu_{i}}, \sigma)=\frac{1}{\sqrt{2 \pi} \sigma} \exp \left(-\frac{1}{2}\left(\frac{y_{i}-\color{#8D44AD}{\mu_{i}}}{\sigma}\right)^{2}\right)
\]</span></p>
<p><span class="math inline">\(\text{where } \color{#8D44AD}{\mu_{i}} = \color{#8D44AD}{\beta_{0}+\beta X_{i}}\)</span></p>
</section>
<section id="thinking-through-our-model-3" class="slide level2">
<h2><em>Thinking</em> through our model</h2>
<p><span class="math display">\[
y_{i} \sim \operatorname{normal}\left(\beta_{0}+\beta X_{i}, \sigma\right) .
\]</span></p>

<img data-src="lec3_files/figure-revealjs/unnamed-chunk-8-1.png" width="960" class="r-stretch"></section>
<section id="writing-our-first-.stan-model" class="slide level2">
<h2>Writing our first <code>.stan</code> model</h2>
<p>Code to do what we are going through is in the <code>week2/</code> Github directory</p>
<p><a href="https://github.com/QFCatMSU/FW-Bayes/blob/main/week2/R/linreg.r"><code>linreg.R</code></a> and <a href="https://github.com/QFCatMSU/FW-Bayes/blob/main/week2/src/linreg.stan"><code>linreg.stan</code></a></p>

<img data-src="images/logo_website.png" style="width:150px; position: absolute; margin-top:-5%; right:3%" class="r-stretch"></section>
<section id="structure-of-a-.stan-file" class="slide level2">
<h2>Structure of a <code>.stan</code> file</h2>
<div style="font-size: 75%;">
<div class="sourceCode" id="cb10"><pre class="sourceCode numberSource stan number-lines code-with-copy"><code class="sourceCode stan"><span id="cb10-1"><a href="#cb10-1"></a><span class="co">// this is a comment </span></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="co">// program block demonstration</span></span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="kw">data</span>{</span>
<span id="cb10-4"><a href="#cb10-4"></a>  <span class="co">// read in data here -- this section is executed one time per Stan run</span></span>
<span id="cb10-5"><a href="#cb10-5"></a>}</span>
<span id="cb10-6"><a href="#cb10-6"></a><span class="kw">transformed data</span> {</span>
<span id="cb10-7"><a href="#cb10-7"></a>  <span class="co">// transform the data here -- this section is also executed one time per Stan run </span></span>
<span id="cb10-8"><a href="#cb10-8"></a>}</span>
<span id="cb10-9"><a href="#cb10-9"></a><span class="kw">parameters</span> {</span>
<span id="cb10-10"><a href="#cb10-10"></a>  <span class="co">// declare the **estimated** parameters here </span></span>
<span id="cb10-11"><a href="#cb10-11"></a>}</span>
<span id="cb10-12"><a href="#cb10-12"></a><span class="kw">transformed parameters</span>{ </span>
<span id="cb10-13"><a href="#cb10-13"></a>  <span class="co">// this section takes parameter estimates and data (or transformed data) </span></span>
<span id="cb10-14"><a href="#cb10-14"></a>  <span class="co">// and transforms them for use later on in model section</span></span>
<span id="cb10-15"><a href="#cb10-15"></a>}</span>
<span id="cb10-16"><a href="#cb10-16"></a><span class="kw">model</span>{</span>
<span id="cb10-17"><a href="#cb10-17"></a>  <span class="co">// this section specifies the prior(s) and likelihood terms, </span></span>
<span id="cb10-18"><a href="#cb10-18"></a>  <span class="co">// and defines a log probability function (i.e., log posterior) of the model</span></span>
<span id="cb10-19"><a href="#cb10-19"></a>}</span>
<span id="cb10-20"><a href="#cb10-20"></a><span class="kw">generated quantities</span>{</span>
<span id="cb10-21"><a href="#cb10-21"></a>  <span class="co">// this section creates derived quantities based on parameters, </span></span>
<span id="cb10-22"><a href="#cb10-22"></a>  <span class="co">// models, data, and (optionally) pseudo-random numbers. </span></span>
<span id="cb10-23"><a href="#cb10-23"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Can also write custom functions (although we won’t in this class)</li>
</ul>
</div>
</section>
<section id="in-words-rather-than-code" class="slide level2">
<h2>In words, rather than code</h2>
<p>As per the comments in the code, each of the program blocks does certain stuff</p>
<div style="font-size: 75%;">
<ul>
<li><code>data{ }</code> reads data into the .stan program</li>
<li><code>transformed data{ }</code> runs calculations on those data (once)</li>
<li><code>parameters{ }</code> declares the <strong><em>estimated</em></strong> parameters in a Stan program</li>
<li><code>transformed parameters{ }</code> takes the parameters, data, and transformed data, and calculates stuff you need for your model</li>
<li><code>model{ }</code> constructs a log probability function:
<ul>
<li><span class="math inline">\(log(posterior) = log(priors) + log(likelihood)\)</span></li>
</ul></li>
<li><code>generated quantities{ }</code> is only executed after you have your sampled posterior
<ul>
<li>useful for calculating derived quantities given your model, data, and parameters</li>
</ul></li>
</ul>
</div>
</section>
<section id="writing-the-linreg.stan-file" class="slide level2">
<h2>Writing the <code>linreg.stan</code> file</h2>
<div style="font-size: 85%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb11-1"><a href="#cb11-1"></a>data {</span>
<span id="cb11-2"><a href="#cb11-2"></a>  int<span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> n<span class="op">;</span> <span class="co">// number of observations </span></span>
<span id="cb11-3"><a href="#cb11-3"></a>  vector[n] y<span class="op">;</span>    <span class="co">// vector of responses </span></span>
<span id="cb11-4"><a href="#cb11-4"></a>  vector[n] x<span class="op">;</span>    <span class="co">// covariate x</span></span>
<span id="cb11-5"><a href="#cb11-5"></a>}</span>
<span id="cb11-6"><a href="#cb11-6"></a>parameters {</span>
<span id="cb11-7"><a href="#cb11-7"></a>  real b0<span class="op">;</span> </span>
<span id="cb11-8"><a href="#cb11-8"></a>  real b1<span class="op">;</span>      </span>
<span id="cb11-9"><a href="#cb11-9"></a>  real<span class="op">&lt;</span>lower <span class="op">=</span> <span class="dv">0</span><span class="op">&gt;</span> sd<span class="op">;</span></span>
<span id="cb11-10"><a href="#cb11-10"></a>}</span>
<span id="cb11-11"><a href="#cb11-11"></a>model {</span>
<span id="cb11-12"><a href="#cb11-12"></a>  <span class="co">// priors</span></span>
<span id="cb11-13"><a href="#cb11-13"></a>  b0 <span class="op">~</span> <span class="fu">normal</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>)<span class="op">;</span>  </span>
<span id="cb11-14"><a href="#cb11-14"></a>  b1 <span class="op">~</span> <span class="fu">normal</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb11-15"><a href="#cb11-15"></a>  sd <span class="op">~</span> <span class="fu">normal</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb11-16"><a href="#cb11-16"></a>  </span>
<span id="cb11-17"><a href="#cb11-17"></a>  <span class="co">// likelihood - one way: </span></span>
<span id="cb11-18"><a href="#cb11-18"></a>  y <span class="op">~</span> <span class="fu">normal</span>(b0 <span class="op">+</span> b1<span class="op">*</span>x<span class="op">,</span> sd)<span class="op">;</span>  <span class="co">// (vectorized, dropping constant, additive terms)</span></span>
<span id="cb11-19"><a href="#cb11-19"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="writing-the-linreg.stan-file-1" class="slide level2">
<h2>Writing the <code>linreg.stan</code> file</h2>
<div style="font-size: 85%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb12-1"><a href="#cb12-1"></a>data {</span>
<span id="cb12-2"><a href="#cb12-2"></a>  int<span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> n<span class="op">;</span> <span class="co">// number of observations </span></span>
<span id="cb12-3"><a href="#cb12-3"></a>  vector[n] y<span class="op">;</span>    <span class="co">// vector of responses </span></span>
<span id="cb12-4"><a href="#cb12-4"></a>  vector[n] x<span class="op">;</span>    <span class="co">// covariate x</span></span>
<span id="cb12-5"><a href="#cb12-5"></a>}</span>
<span id="cb12-6"><a href="#cb12-6"></a>parameters {</span>
<span id="cb12-7"><a href="#cb12-7"></a>  real b0<span class="op">;</span> </span>
<span id="cb12-8"><a href="#cb12-8"></a>  real b1<span class="op">;</span>      </span>
<span id="cb12-9"><a href="#cb12-9"></a>  real<span class="op">&lt;</span>lower <span class="op">=</span> <span class="dv">0</span><span class="op">&gt;</span> sd<span class="op">;</span></span>
<span id="cb12-10"><a href="#cb12-10"></a>}</span>
<span id="cb12-11"><a href="#cb12-11"></a>model {</span>
<span id="cb12-12"><a href="#cb12-12"></a>  <span class="co">// priors</span></span>
<span id="cb12-13"><a href="#cb12-13"></a>  b0 <span class="op">~</span> <span class="fu">normal</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>)<span class="op">;</span>  </span>
<span id="cb12-14"><a href="#cb12-14"></a>  b1 <span class="op">~</span> <span class="fu">normal</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb12-15"><a href="#cb12-15"></a>  sd <span class="op">~</span> <span class="fu">normal</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb12-16"><a href="#cb12-16"></a>  </span>
<span id="cb12-17"><a href="#cb12-17"></a>  <span class="co">// likelihood - loopy way: </span></span>
<span id="cb12-18"><a href="#cb12-18"></a>  <span class="cf">for</span>(i <span class="kw">in</span> <span class="dv">1</span><span class="op">:</span>nobs){</span>
<span id="cb12-19"><a href="#cb12-19"></a>    y[i] <span class="op">~</span> <span class="fu">normal</span>(b0 <span class="op">+</span> b1<span class="op">*</span>x[i]<span class="op">,</span> sd)<span class="op">;</span> </span>
<span id="cb12-20"><a href="#cb12-20"></a>  }</span>
<span id="cb12-21"><a href="#cb12-21"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="writing-the-linreg.stan-file-2" class="slide level2">
<h2>Writing the <code>linreg.stan</code> file</h2>
<div style="font-size: 85%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb13-1"><a href="#cb13-1"></a>data {</span>
<span id="cb13-2"><a href="#cb13-2"></a>  int<span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> n<span class="op">;</span> <span class="co">// number of observations </span></span>
<span id="cb13-3"><a href="#cb13-3"></a>  vector[n] y<span class="op">;</span>    <span class="co">// vector of responses </span></span>
<span id="cb13-4"><a href="#cb13-4"></a>  vector[n] x<span class="op">;</span>    <span class="co">// covariate x</span></span>
<span id="cb13-5"><a href="#cb13-5"></a>}</span>
<span id="cb13-6"><a href="#cb13-6"></a>parameters {</span>
<span id="cb13-7"><a href="#cb13-7"></a>  real b0<span class="op">;</span> </span>
<span id="cb13-8"><a href="#cb13-8"></a>  real b1<span class="op">;</span>      </span>
<span id="cb13-9"><a href="#cb13-9"></a>  real<span class="op">&lt;</span>lower <span class="op">=</span> <span class="dv">0</span><span class="op">&gt;</span> sd<span class="op">;</span></span>
<span id="cb13-10"><a href="#cb13-10"></a>}</span>
<span id="cb13-11"><a href="#cb13-11"></a>model {</span>
<span id="cb13-12"><a href="#cb13-12"></a>  <span class="co">// priors</span></span>
<span id="cb13-13"><a href="#cb13-13"></a>  b0 <span class="op">~</span> <span class="fu">normal</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>)<span class="op">;</span>  </span>
<span id="cb13-14"><a href="#cb13-14"></a>  b1 <span class="op">~</span> <span class="fu">normal</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb13-15"><a href="#cb13-15"></a>  sd <span class="op">~</span> <span class="fu">normal</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb13-16"><a href="#cb13-16"></a>  </span>
<span id="cb13-17"><a href="#cb13-17"></a>  <span class="co">// likelihood - yet another way: </span></span>
<span id="cb13-18"><a href="#cb13-18"></a>  target <span class="op">+=</span> <span class="fu">normal_lpdf</span>(y <span class="op">|</span> b0 <span class="op">+</span> b1<span class="op">*</span>x<span class="op">,</span> sd)<span class="op">;</span> <span class="co">// log(normal dens) (constants included)</span></span>
<span id="cb13-19"><a href="#cb13-19"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="key-points" class="slide level2">
<h2>Key points</h2>
<ul>
<li>These three likelihood configurations result in the same parameter estimates, but option (3) will give you a different log posterior (<code>lp__</code>)
<ul>
<li>Vectorized option is the fastest, but sometimes these other configurations are helpful in specific applications</li>
</ul></li>
<li>Stan sets up the log(posterior) as the log(likelihood) + log(priors) if you specify likelihood and priors</li>
</ul>
</section>
<section id="some-notes-on-priors-in-stan" class="slide level2">
<h2>Some notes on priors in Stan</h2>
<div style="font-size: 85%;">
<ul>
<li>If you don’t specify priors, <em>Stan will specify flat priors for you</em>
<ul>
<li>Not always a good thing, and it can lead to problems</li>
</ul></li>
<li>In this class we are either going to use vague or uninformative priors, OR we will use informative priors that incorporate domain expertise or information from previous studies</li>
<li>When we say a prior is “weakly informative,” what we mean is that if there’s a large amount of data, the likelihood will dominate, and the prior will not be important
<ul>
<li>Prior can often only be understood in the context of the likelihood (Gelman et al.&nbsp;2017; see also <a href="https://github.com/stan-dev/stan/wiki/Prior-Choice-Recommendations">prior recommendations in Stan</a>)</li>
</ul></li>
</ul>
<p><span class="footerLeft">see arguments in Kery and Schaub 2012; Gelman et al.&nbsp;2017; McElreath 2023</span></p>
</div>
</section>
<section id="some-tips-for-debugging-.stan-code" class="slide level2">
<h2>Some tips for debugging <code>.stan</code> code</h2>
<ul>
<li>Use one chain (else prepare for impending doomies)</li>
<li>Use a low number of iterations (i.e., like 1-30)</li>
<li>wrap things in <code>print()</code> statements in Stan</li>
<li>Simulate fake data representing your model (you’ll know what truth is)</li>
<li>Build fast, fail fast</li>
<li>Plot everything</li>
</ul>
</section>
<section id="controlling-everything-from-linreg.r" class="slide level2">
<h2>Controlling everything from <code>linreg.R</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="co"># compile the .stan model</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>mod <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(<span class="st">"src/linreg.stan"</span>)</span>
<span id="cb14-3"><a href="#cb14-3"></a></span>
<span id="cb14-4"><a href="#cb14-4"></a><span class="co"># create a tagged data list</span></span>
<span id="cb14-5"><a href="#cb14-5"></a><span class="co"># names must correspond to data block{} in .stan</span></span>
<span id="cb14-6"><a href="#cb14-6"></a>stan_data <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">n =</span> <span class="fu">nrow</span>(data), <span class="at">y =</span> data<span class="sc">$</span>y, <span class="at">x =</span> data<span class="sc">$</span>x)</span>
<span id="cb14-7"><a href="#cb14-7"></a></span>
<span id="cb14-8"><a href="#cb14-8"></a><span class="co"># write a function to set starting values</span></span>
<span id="cb14-9"><a href="#cb14-9"></a>inits <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb14-10"><a href="#cb14-10"></a>  <span class="fu">list</span>(</span>
<span id="cb14-11"><a href="#cb14-11"></a>    <span class="at">b0 =</span> <span class="fu">jitter</span>(<span class="dv">0</span>, <span class="at">amount =</span> <span class="fl">0.05</span>),</span>
<span id="cb14-12"><a href="#cb14-12"></a>    <span class="at">b1 =</span> <span class="fu">jitter</span>(<span class="dv">0</span>, <span class="at">amount =</span> <span class="dv">1</span>),</span>
<span id="cb14-13"><a href="#cb14-13"></a>    <span class="at">sd =</span> <span class="fu">jitter</span>(<span class="dv">1</span>, <span class="at">amount =</span> <span class="fl">0.5</span>)</span>
<span id="cb14-14"><a href="#cb14-14"></a>  )</span>
<span id="cb14-15"><a href="#cb14-15"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="controlling-everything-from-linreg.r-1" class="slide level2">
<h2>Controlling everything from <code>linreg.R</code></h2>
<div style="font-size: 85%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># what happens when we call the inits() function</span></span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="fu">inits</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$b0
[1] -0.04361975

$b1
[1] 0.5690925

$sd
[1] 0.9183216</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="fu">inits</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$b0
[1] 0.04810181

$b1
[1] -0.4342321

$sd
[1] 1.347882</code></pre>
</div>
</div>
<ul>
<li>Can pass this inits function to stan to initialize each of our MCMC chains at different parameter values</li>
</ul>
</div>
</section>
<section id="running-the-model" class="slide level2">
<h2>Running the model</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>fit <span class="ot">&lt;-</span> mod<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb19-2"><a href="#cb19-2"></a>  <span class="at">data =</span> stan_data, <span class="co"># tagged stan_data list</span></span>
<span id="cb19-3"><a href="#cb19-3"></a>  <span class="at">init =</span> inits, <span class="co"># `inits()` is the function here</span></span>
<span id="cb19-4"><a href="#cb19-4"></a>  <span class="at">seed =</span> <span class="dv">13</span>, <span class="co"># ensure simulations are reproducible</span></span>
<span id="cb19-5"><a href="#cb19-5"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="co"># multiple chains</span></span>
<span id="cb19-6"><a href="#cb19-6"></a>  <span class="at">iter_warmup =</span> <span class="dv">1000</span>, <span class="co"># how long to warm up the chains</span></span>
<span id="cb19-7"><a href="#cb19-7"></a>  <span class="at">iter_sampling =</span> <span class="dv">1000</span>, <span class="co"># how many samples after warmp</span></span>
<span id="cb19-8"><a href="#cb19-8"></a>  <span class="at">parallel_chains =</span> <span class="dv">4</span>, <span class="co"># run them in parallel?</span></span>
<span id="cb19-9"><a href="#cb19-9"></a>  <span class="at">refresh =</span> <span class="dv">500</span> <span class="co"># print update every 500 iters</span></span>
<span id="cb19-10"><a href="#cb19-10"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>see also <code>?sampling</code> for <em>many</em> other options</li>
<li>1000 iterations for warmup and sampling is not a bad place to start (however see debugging tips at the end of the lecture)</li>
</ul>
</section>
<section id="running-the-model-1" class="slide level2">
<h2>Running the model</h2>
<div style="font-size: 55%;">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 parallel chains...

Chain 1 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 1 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 1 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 2 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 2 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 2 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 3 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 3 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 3 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 4 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 4 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 4 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 1 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 1 finished in 0.2 seconds.
Chain 2 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 2 finished in 0.2 seconds.
Chain 3 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 3 finished in 0.2 seconds.
Chain 4 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 4 finished in 0.2 seconds.

All 4 chains finished successfully.
Mean chain execution time: 0.2 seconds.
Total execution time: 0.6 seconds.</code></pre>
</div>
</div>
</div>
</section>
<section id="bayesian-model-diagnostics" class="slide level2">
<h2>Bayesian model diagnostics</h2>
<ul>
<li><p>Diagnostics for Bayesian models can be lumped into two categories:</p>
<ol type="1">
<li>Diagnostics that evaluate the performance of your MCMC algorithm</li>
<li>Diagnostics that help you understand your model fit vs.&nbsp;observed data</li>
</ol></li>
</ul>
<p><strong>Both types of checks are required to ensure the reliability of your inferences in a Bayesian setting</strong></p>
<ul>
<li>We will start with MCMC diagnostics</li>
</ul>
<p><span class="footerRight">Gelman et al.&nbsp;2021; McElreath 2023</span></p>
</section>
<section id="did-stan-run-into-any-obvious-issues" class="slide level2">
<h2>Did Stan run into any obvious issues?</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>fit<span class="sc">$</span><span class="fu">diagnostic_summary</span>() <span class="co"># sampler diagnostic summaries</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$num_divergent
[1] 0 0 0 0

$num_max_treedepth
[1] 0 0 0 0

$ebfmi
[1] 1.115859 1.040690 1.054994 1.177122</code></pre>
</div>
</div>
<div style="font-size: 75%;">
<ul>
<li><p><a href="https://mc-stan.org/misc/warnings.html">see here</a> for a description of runtime warnings and issues related to convergence problems</p></li>
<li><p>Hamiltonian based Estimated Bayesian Fraction of Missing Information (e-bfmi) quantifies how hard it is to sample level sets at each iteration</p>
<ul>
<li>if very low (i.e., &lt; 0.3), sampler is having a difficult time sampling the target distribution (<a href="https://arxiv.org/abs/1701.02434">Betancourt 2017</a>)</li>
</ul></li>
</ul>
</div>
</section>
<section id="examine-widehatr" class="slide level2">
<h2>Examine <span class="math inline">\(\widehat{R}\)</span></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="co"># Have the chains converged to a common distribution?</span></span>
<span id="cb23-2"><a href="#cb23-2"></a><span class="co"># compares the between- and within-chain estimates for parameters</span></span>
<span id="cb23-3"><a href="#cb23-3"></a>rhats <span class="ot">&lt;-</span> <span class="fu">rhat</span>(fit)</span>
<span id="cb23-4"><a href="#cb23-4"></a><span class="fu">mcmc_rhat</span>(rhats) <span class="co"># should all be less than 1.05 as rule of thumb</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="lec3_files/figure-revealjs/unnamed-chunk-17-1.png" width="960" class="r-stretch"><p><span class="footerRight">Gelman et al.&nbsp;2021; McElreath 2023; Vehtari et al.&nbsp;2019</span></p>
</section>
<section id="examine-the-number-of-effective-samples" class="slide level2">
<h2>Examine the number of effective samples</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>eff <span class="ot">&lt;-</span> <span class="fu">neff_ratio</span>(fit)</span>
<span id="cb24-2"><a href="#cb24-2"></a><span class="fu">mcmc_neff</span>(eff) <span class="co"># rule of thumb is worry about ratios &lt; 0.1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="lec3_files/figure-revealjs/unnamed-chunk-18-1.png" width="960" class="r-stretch"><p><span class="footerRight">Gelman et al.&nbsp;2021; McElreath 2023; Vehtari et al.&nbsp;2019</span></p>
</section>
<section id="extracting-the-posterior-draws-from-our-cmdstanfit-object" class="slide level2">
<h2>Extracting the posterior draws from our <code>CmdStanFit</code> object</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="co"># extract the posterior draws</span></span>
<span id="cb25-2"><a href="#cb25-2"></a>posterior <span class="ot">&lt;-</span> fit<span class="sc">$</span><span class="fu">draws</span>(<span class="at">format =</span> <span class="st">"df"</span>) <span class="co"># extract draws x variables df</span></span>
<span id="cb25-3"><a href="#cb25-3"></a><span class="fu">head</span>(posterior)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A draws_df: 6 iterations, 1 chains, and 4 variables
  lp__  b0   b1   sd
1  -37 2.3 0.69 0.90
2  -37 2.1 0.71 0.97
3  -38 2.0 0.73 0.95
4  -38 2.0 0.74 0.98
5  -37 2.4 0.68 0.92
6  -37 2.4 0.69 0.99
# ... hidden reserved variables {'.chain', '.iteration', '.draw'}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="fu">dim</span>(posterior)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4000    7</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a>np <span class="ot">&lt;-</span> <span class="fu">nuts_params</span>(fit) <span class="co"># get the sampler parameters - useful for debugging</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="lets-get-tidy-visualizing-the-chains" class="slide level2">
<h2>Let’s get tidy: visualizing the chains</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="fu">color_scheme_set</span>(<span class="st">"blue"</span>) <span class="co"># bayesplot color themes</span></span>
<span id="cb30-2"><a href="#cb30-2"></a><span class="co"># plot the chains of all parameters</span></span>
<span id="cb30-3"><a href="#cb30-3"></a>p <span class="ot">&lt;-</span> <span class="fu">mcmc_trace</span>(posterior, <span class="at">np =</span> np) <span class="sc">+</span></span>
<span id="cb30-4"><a href="#cb30-4"></a>  <span class="fu">theme_qfc</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>))</span>
<span id="cb30-5"><a href="#cb30-5"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="lec3_files/figure-revealjs/unnamed-chunk-20-1.png" width="960" class="r-stretch"></section>
<section id="lets-get-tidy-visualizing-a-chain" class="slide level2">
<h2>Let’s get tidy: visualizing a chain</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="co"># plot chain of one parameter</span></span>
<span id="cb31-2"><a href="#cb31-2"></a>p <span class="ot">&lt;-</span> <span class="fu">mcmc_trace</span>(posterior, <span class="at">pars =</span> <span class="st">"sd"</span>, <span class="at">np =</span> np) <span class="sc">+</span></span>
<span id="cb31-3"><a href="#cb31-3"></a>  <span class="fu">theme_qfc</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>))</span>
<span id="cb31-4"><a href="#cb31-4"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="lec3_files/figure-revealjs/unnamed-chunk-21-1.png" width="960" class="r-stretch"></section>
<section id="lets-get-tidy-zooming-in-on-chains" class="slide level2">
<h2>Let’s get tidy: zooming in on chains</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="co"># zoom in on one parameter iterations 600-721 (bc why not?)</span></span>
<span id="cb32-2"><a href="#cb32-2"></a>p <span class="ot">&lt;-</span> <span class="fu">mcmc_trace</span>(posterior, <span class="at">pars =</span> <span class="st">"sd"</span>, <span class="at">window =</span> <span class="fu">c</span>(<span class="dv">600</span>, <span class="dv">721</span>), <span class="at">np =</span> np) <span class="sc">+</span></span>
<span id="cb32-3"><a href="#cb32-3"></a>  <span class="fu">theme_qfc</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>))</span>
<span id="cb32-4"><a href="#cb32-4"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="lec3_files/figure-revealjs/unnamed-chunk-22-1.png" width="960" class="r-stretch"></section>
<section id="lets-get-tidy-highlighting-one-chain" class="slide level2">
<h2>Let’s get tidy: highlighting one chain</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="co"># highlight chain 2 vs. other chains:</span></span>
<span id="cb33-2"><a href="#cb33-2"></a>p <span class="ot">&lt;-</span> <span class="fu">mcmc_trace_highlight</span>(posterior, <span class="at">pars =</span> <span class="st">"sd"</span>, <span class="at">highlight =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb33-3"><a href="#cb33-3"></a>  <span class="fu">theme_qfc</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>))</span>
<span id="cb33-4"><a href="#cb33-4"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="lec3_files/figure-revealjs/unnamed-chunk-23-1.png" width="960" class="r-stretch"></section>
<section id="lets-get-tidy-pairs-plots" class="slide level2">
<h2>Let’s get tidy: pairs plots</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a><span class="co"># pairs plots  - good modelers almost always use this</span></span>
<span id="cb34-2"><a href="#cb34-2"></a>p <span class="ot">&lt;-</span> <span class="fu">mcmc_pairs</span>(posterior, <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">"b0"</span>, <span class="st">"b1"</span>, <span class="st">"sd"</span>), <span class="at">np =</span> np)</span>
<span id="cb34-3"><a href="#cb34-3"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="lec3_files/figure-revealjs/unnamed-chunk-24-1.png" width="960" class="r-stretch"></section>
<section id="lets-get-tidy-pairs-plots-1" class="slide level2">
<h2>Let’s get tidy: pairs plots</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="co"># pairs plots - good modelers almost always use this</span></span>
<span id="cb35-2"><a href="#cb35-2"></a><span class="co"># two parameters only:</span></span>
<span id="cb35-3"><a href="#cb35-3"></a>p <span class="ot">&lt;-</span> <span class="fu">mcmc_scatter</span>(posterior, <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">"b1"</span>, <span class="st">"b0"</span>), <span class="at">np =</span> np) <span class="sc">+</span></span>
<span id="cb35-4"><a href="#cb35-4"></a>  <span class="fu">theme_qfc</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>))</span>
<span id="cb35-5"><a href="#cb35-5"></a>p <span class="co"># check out that negative correlation!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="lec3_files/figure-revealjs/unnamed-chunk-25-1.png" width="960" class="r-stretch"></section>
<section id="lets-get-tidy-pairs-plots-quantiles" class="slide level2">
<h2>Let’s get tidy: pairs plots + quantiles</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a><span class="co"># add an 83% (why not, the world is your oyster) ellipse to it</span></span>
<span id="cb36-2"><a href="#cb36-2"></a>p <span class="sc">+</span> <span class="fu">stat_ellipse</span>(<span class="at">level =</span> <span class="fl">0.83</span>, <span class="at">color =</span> <span class="st">"darkorange2"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb36-3"><a href="#cb36-3"></a>  <span class="fu">theme_qfc</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="lec3_files/figure-revealjs/unnamed-chunk-26-1.png" width="960" class="r-stretch"></section>
<section id="lets-get-tidy-pairs-plots-contours" class="slide level2">
<h2>Let’s get tidy: pairs plots + contours</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a><span class="co"># visualize the posterior distribution's contours for b0, b1</span></span>
<span id="cb37-2"><a href="#cb37-2"></a>p <span class="sc">+</span> <span class="fu">stat_density_2d</span>(<span class="at">color =</span> <span class="st">"darkorange2"</span>, <span class="at">size =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb37-3"><a href="#cb37-3"></a>  <span class="fu">theme_qfc</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="lec3_files/figure-revealjs/unnamed-chunk-27-1.png" width="960" class="r-stretch"></section>
<section id="lets-get-tidy-pairs-plots-contours-1" class="slide level2">
<h2>Let’s get tidy: pairs plots + contours</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a><span class="co"># view it a different way</span></span>
<span id="cb38-2"><a href="#cb38-2"></a><span class="fu">mcmc_hex</span>(posterior, <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">"b0"</span>, <span class="st">"b1"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="lec3_files/figure-revealjs/unnamed-chunk-28-1.png" width="960" class="r-stretch"></section>
<section id="lets-get-tidy-divergent-transitions" class="slide level2">
<h2>Let’s get tidy: divergent transitions</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a><span class="co"># visualizing divergent transitions</span></span>
<span id="cb39-2"><a href="#cb39-2"></a><span class="co"># none here, but this plot shows each iteration as a line connecting</span></span>
<span id="cb39-3"><a href="#cb39-3"></a><span class="co"># parameter values, and divergent iterations will show up as red lines</span></span>
<span id="cb39-4"><a href="#cb39-4"></a><span class="co"># sometimes this helps you find combinations of parameters that are</span></span>
<span id="cb39-5"><a href="#cb39-5"></a><span class="co"># leading to divergent transitions</span></span>
<span id="cb39-6"><a href="#cb39-6"></a></span>
<span id="cb39-7"><a href="#cb39-7"></a><span class="fu">mcmc_parcoord</span>(posterior,</span>
<span id="cb39-8"><a href="#cb39-8"></a>  <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">"sd"</span>, <span class="st">"b0"</span>, <span class="st">"b1"</span>),</span>
<span id="cb39-9"><a href="#cb39-9"></a>  <span class="at">transform =</span> <span class="cf">function</span>(x) {</span>
<span id="cb39-10"><a href="#cb39-10"></a>    (x <span class="sc">-</span> <span class="fu">mean</span>(x)) <span class="sc">/</span> <span class="fu">sd</span>(x) <span class="co"># mean standardize (easier to compare)</span></span>
<span id="cb39-11"><a href="#cb39-11"></a>  },</span>
<span id="cb39-12"><a href="#cb39-12"></a>  <span class="at">np =</span> np</span>
<span id="cb39-13"><a href="#cb39-13"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="lets-get-tidy-divergent-transitions-1" class="slide level2">
<h2>Let’s get tidy: divergent transitions</h2>

<img data-src="lec3_files/figure-revealjs/unnamed-chunk-30-1.png" width="960" class="r-stretch"></section>
<section id="moving-on-to-fits-vs.-data-checks" class="slide level2">
<h2>Moving on to fits vs.&nbsp;data checks</h2>
<p>Posterior predictive checks (PPCs)</p>
<ul>
<li>Generate replicate datasets based on our posterior draws</li>
<li>A great way to find discrepancies between your fitted model and the data, critical test for Bayesian models</li>
<li>Always do them</li>
</ul>
</section>
<section id="posterior-predictive-checks-in-r" class="slide level2">
<h2>Posterior predictive checks in R</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a><span class="fu">head</span>(posterior)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A draws_df: 6 iterations, 1 chains, and 4 variables
  lp__  b0   b1   sd
1  -37 2.3 0.69 0.90
2  -37 2.1 0.71 0.97
3  -38 2.0 0.73 0.95
4  -38 2.0 0.74 0.98
5  -37 2.4 0.68 0.92
6  -37 2.4 0.69 0.99
# ... hidden reserved variables {'.chain', '.iteration', '.draw'}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a>b0 <span class="ot">&lt;-</span> posterior<span class="sc">$</span>b0</span>
<span id="cb42-2"><a href="#cb42-2"></a>b1 <span class="ot">&lt;-</span> posterior<span class="sc">$</span>b1</span>
<span id="cb42-3"><a href="#cb42-3"></a>sd <span class="ot">&lt;-</span> posterior<span class="sc">$</span>sd</span>
<span id="cb42-4"><a href="#cb42-4"></a></span>
<span id="cb42-5"><a href="#cb42-5"></a><span class="co"># generate 1 dataset from the first draw of the posterior:</span></span>
<span id="cb42-6"><a href="#cb42-6"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb42-7"><a href="#cb42-7"></a>y_rep <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(data<span class="sc">$</span>x), b0[<span class="dv">1</span>] <span class="sc">+</span> b1[<span class="dv">1</span>] <span class="sc">*</span> data<span class="sc">$</span>x, sd[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="posterior-predictive-checks-in-r-1" class="slide level2">
<h2>Posterior predictive checks in R</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a><span class="co"># now do it for the whole posterior</span></span>
<span id="cb43-2"><a href="#cb43-2"></a><span class="co"># loop through and create replicate datasets based on</span></span>
<span id="cb43-3"><a href="#cb43-3"></a><span class="co"># each_draw_of_posterior</span></span>
<span id="cb43-4"><a href="#cb43-4"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb43-5"><a href="#cb43-5"></a>y_rep <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(posterior), <span class="at">ncol =</span> <span class="fu">length</span>(data<span class="sc">$</span>y))</span>
<span id="cb43-6"><a href="#cb43-6"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(posterior)) {</span>
<span id="cb43-7"><a href="#cb43-7"></a>  y_rep[i, ] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(data<span class="sc">$</span>x), b0[i] <span class="sc">+</span> b1[i] <span class="sc">*</span> data<span class="sc">$</span>x, sd[i])</span>
<span id="cb43-8"><a href="#cb43-8"></a>}</span>
<span id="cb43-9"><a href="#cb43-9"></a><span class="fu">dim</span>(y_rep)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4000   84</code></pre>
</div>
</div>
</section>
<section id="posterior-predictive-checks-in-stan" class="slide level2">
<h2>Posterior predictive checks in Stan</h2>
<ul>
<li>Can do this in Stan directly via the <code>generated quantities{ }</code> section:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb45-1"><a href="#cb45-1"></a>generated quantities {</span>
<span id="cb45-2"><a href="#cb45-2"></a>  <span class="co">// replications for the posterior predictive distributions</span></span>
<span id="cb45-3"><a href="#cb45-3"></a>  array[n] real y_rep <span class="op">=</span> <span class="fu">normal_rng</span>(b0 <span class="op">+</span> b1<span class="op">*</span>x<span class="op">,</span> sd)<span class="op">;</span></span>
<span id="cb45-4"><a href="#cb45-4"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="posterior-predictive-checks-in-stan-1" class="slide level2">
<h2>Posterior predictive checks in Stan</h2>
<ul>
<li>Recompile and re-run:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(<span class="st">"src/linreg_ppc.stan"</span>)</span>
<span id="cb46-2"><a href="#cb46-2"></a>fit <span class="ot">&lt;-</span> mod<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb46-3"><a href="#cb46-3"></a>  <span class="at">data =</span> stan_data,</span>
<span id="cb46-4"><a href="#cb46-4"></a>  <span class="at">init =</span> inits,</span>
<span id="cb46-5"><a href="#cb46-5"></a>  <span class="at">seed =</span> <span class="dv">13</span>, <span class="co"># ensure simulations are reproducible</span></span>
<span id="cb46-6"><a href="#cb46-6"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="co"># multiple chains</span></span>
<span id="cb46-7"><a href="#cb46-7"></a>  <span class="at">iter_warmup =</span> <span class="dv">1000</span>, <span class="co"># how long to warm up the chains</span></span>
<span id="cb46-8"><a href="#cb46-8"></a>  <span class="at">iter_sampling =</span> <span class="dv">1000</span>, <span class="co"># how many samples after warmp</span></span>
<span id="cb46-9"><a href="#cb46-9"></a>  <span class="at">parallel_chains =</span> <span class="dv">4</span>, <span class="co"># run them in parallel?</span></span>
<span id="cb46-10"><a href="#cb46-10"></a>  <span class="at">refresh =</span> <span class="dv">0</span></span>
<span id="cb46-11"><a href="#cb46-11"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 parallel chains...

Chain 1 finished in 0.4 seconds.
Chain 2 finished in 0.4 seconds.
Chain 3 finished in 0.4 seconds.
Chain 4 finished in 0.4 seconds.

All 4 chains finished successfully.
Mean chain execution time: 0.4 seconds.
Total execution time: 0.6 seconds.</code></pre>
</div>
</div>
</section>
<section id="posterior-predictive-checks-in-stan-2" class="slide level2">
<h2>Posterior predictive checks in Stan</h2>
<div style="font-size: 75%;">
<ul>
<li>Extract the posterior and take a gander at our new <code>y_reps</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a>posterior <span class="ot">&lt;-</span> fit<span class="sc">$</span><span class="fu">draws</span>(<span class="at">format =</span> <span class="st">"df"</span>) <span class="co"># extract draws x variables data frame</span></span>
<span id="cb48-2"><a href="#cb48-2"></a><span class="fu">head</span>(posterior)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A draws_df: 6 iterations, 1 chains, and 88 variables
  lp__  b0   b1   sd y_rep[1] y_rep[2] y_rep[3] y_rep[4]
1  -37 2.3 0.71 0.93      3.1      6.5     2.49       11
2  -38 2.3 0.71 1.06      3.7      5.5     2.45       10
3  -40 2.1 0.74 0.87      3.6      4.6     2.56       11
4  -40 1.9 0.73 1.06      4.2      6.1     0.12       12
5  -37 2.4 0.67 0.92      5.7      7.2     2.63       10
6  -37 2.4 0.67 0.98      4.0      6.3     1.63       13
# ... with 80 more variables
# ... hidden reserved variables {'.chain', '.iteration', '.draw'}</code></pre>
</div>
</div>
<ul>
<li>Stan generated or simulated replicate <code>y_rep</code> “datasets”
<ul>
<li>n_iter*n_chain = number of posterior draws</li>
</ul></li>
<li>Now compare the simulated data to our original (real) dataset</li>
</ul>
</div>
</section>
<section id="even-more-tidy-visualizing-ppcs" class="slide level2">
<h2>Even more tidy: visualizing PPCs</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a>y_rep <span class="ot">&lt;-</span> posterior[<span class="fu">grepl</span>(<span class="st">"y_rep"</span>, <span class="fu">names</span>(posterior))]</span>
<span id="cb50-2"><a href="#cb50-2"></a></span>
<span id="cb50-3"><a href="#cb50-3"></a><span class="co"># compare original data against 15 simulated datasets:</span></span>
<span id="cb50-4"><a href="#cb50-4"></a>p <span class="ot">&lt;-</span> <span class="fu">ppc_hist</span>(<span class="at">y =</span> data<span class="sc">$</span>y, <span class="at">yrep =</span> <span class="fu">as.matrix</span>(y_rep[<span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>, ]))</span>
<span id="cb50-5"><a href="#cb50-5"></a>p <span class="sc">+</span> <span class="fu">theme_qfc</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="lec3_files/figure-revealjs/unnamed-chunk-36-1.png" width="960" class="r-stretch"></section>
<section id="even-more-tidy-visualizing-ppcs-1" class="slide level2">
<h2>Even more tidy: visualizing PPCs</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a>y_rep <span class="ot">&lt;-</span> posterior[<span class="fu">grepl</span>(<span class="st">"y_rep"</span>, <span class="fu">names</span>(posterior))]</span>
<span id="cb51-2"><a href="#cb51-2"></a></span>
<span id="cb51-3"><a href="#cb51-3"></a><span class="co"># compare original data against 15 simulated datasets:</span></span>
<span id="cb51-4"><a href="#cb51-4"></a>p <span class="ot">&lt;-</span> <span class="fu">ppc_dens_overlay</span>(<span class="at">y =</span> data<span class="sc">$</span>y, <span class="at">yrep =</span> <span class="fu">as.matrix</span>(y_rep[<span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>, ]))</span>
<span id="cb51-5"><a href="#cb51-5"></a>p <span class="sc">+</span> <span class="fu">theme_qfc</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="lec3_files/figure-revealjs/unnamed-chunk-37-1.png" width="960" class="r-stretch"></section>
<section id="visualizing-ppcs-another-way" class="slide level2">
<h2>Visualizing PPCs another way</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a><span class="co"># ppcs, another way</span></span>
<span id="cb52-2"><a href="#cb52-2"></a>y_reps <span class="ot">&lt;-</span> y_rep[<span class="fu">sample</span>(<span class="fu">nrow</span>(y_rep), <span class="dv">9</span>), ] <span class="co"># draw 9 replicate datsets</span></span>
<span id="cb52-3"><a href="#cb52-3"></a>ind <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">9</span>, <span class="dv">1</span>)</span>
<span id="cb52-4"><a href="#cb52-4"></a>y_reps[ind, ] <span class="ot">&lt;-</span> <span class="fu">as.list</span>(data<span class="sc">$</span>y) <span class="co"># replace a random y_rep with true y</span></span>
<span id="cb52-5"><a href="#cb52-5"></a></span>
<span id="cb52-6"><a href="#cb52-6"></a>yrep_df <span class="ot">&lt;-</span> y_reps <span class="sc">%&gt;%</span></span>
<span id="cb52-7"><a href="#cb52-7"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb52-8"><a href="#cb52-8"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> <span class="co"># use the long format for plotting</span></span>
<span id="cb52-9"><a href="#cb52-9"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>, <span class="at">each =</span> <span class="fu">ncol</span>(y_reps)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="visualizing-ppcs-another-way-1" class="slide level2">
<h2>Visualizing PPCs another way</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a><span class="co"># ppcs, another way</span></span>
<span id="cb53-2"><a href="#cb53-2"></a>yrep_df <span class="sc">%&gt;%</span></span>
<span id="cb53-3"><a href="#cb53-3"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb53-4"><a href="#cb53-4"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> value),</span>
<span id="cb53-5"><a href="#cb53-5"></a>    <span class="at">fill =</span> <span class="st">"steelblue"</span>,</span>
<span id="cb53-6"><a href="#cb53-6"></a>    <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">binwidth =</span> <span class="dv">1</span></span>
<span id="cb53-7"><a href="#cb53-7"></a>  ) <span class="sc">+</span></span>
<span id="cb53-8"><a href="#cb53-8"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>name, <span class="at">nrow =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb53-9"><a href="#cb53-9"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb53-10"><a href="#cb53-10"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb53-11"><a href="#cb53-11"></a>  <span class="fu">ggtitle</span>(<span class="st">"Can you spot the real data?"</span>) <span class="sc">+</span></span>
<span id="cb53-12"><a href="#cb53-12"></a>  <span class="fu">theme_qfc</span>() <span class="sc">+</span></span>
<span id="cb53-13"><a href="#cb53-13"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="visualizing-ppcs-another-way-2" class="slide level2">
<h2>Visualizing PPCs another way</h2>

<img data-src="lec3_files/figure-revealjs/unnamed-chunk-40-1.png" width="960" class="r-stretch"></section>
<section id="prior-predictive-checks" class="slide level2">
<h2>Prior predictive checks</h2>
<ul>
<li>Same idea as posterior predictive checks, but we ignore the likelihood</li>
<li>Simply sample replicate datasets from the prior(s)</li>
<li>Tries to get at whether our priors + model configuration are consistent with our knowledge of the system</li>
<li>Usually would do these before posterior predictive checks, but easier to explain once you understand what posterior predictive checks are</li>
</ul>
</section>
<section id="prior-predictive-checks-1" class="slide level2">
<h2>Prior predictive checks</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(<span class="st">"src/linreg_priorpc.stan"</span>)</span>
<span id="cb54-2"><a href="#cb54-2"></a></span>
<span id="cb54-3"><a href="#cb54-3"></a>fit <span class="ot">&lt;-</span> mod<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb54-4"><a href="#cb54-4"></a>  <span class="at">data =</span> stan_data,</span>
<span id="cb54-5"><a href="#cb54-5"></a>  <span class="at">init =</span> inits,</span>
<span id="cb54-6"><a href="#cb54-6"></a>  <span class="at">seed =</span> <span class="dv">13</span>,</span>
<span id="cb54-7"><a href="#cb54-7"></a>  <span class="at">chains =</span> <span class="dv">1</span>,</span>
<span id="cb54-8"><a href="#cb54-8"></a>  <span class="at">iter_warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb54-9"><a href="#cb54-9"></a>  <span class="at">iter_sampling =</span> <span class="dv">1000</span>,</span>
<span id="cb54-10"><a href="#cb54-10"></a>  <span class="at">parallel_chains =</span> <span class="dv">1</span>,</span>
<span id="cb54-11"><a href="#cb54-11"></a>  <span class="at">refresh =</span> <span class="dv">0</span></span>
<span id="cb54-12"><a href="#cb54-12"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 1 chain...

Chain 1 finished in 0.2 seconds.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1"></a><span class="co"># extract the draws:</span></span>
<span id="cb56-2"><a href="#cb56-2"></a>prior_draws <span class="ot">&lt;-</span> fit<span class="sc">$</span><span class="fu">draws</span>(<span class="at">format =</span> <span class="st">"df"</span>)</span>
<span id="cb56-3"><a href="#cb56-3"></a>y_rep <span class="ot">&lt;-</span> prior_draws[<span class="fu">grepl</span>(<span class="st">"y_rep"</span>, <span class="fu">names</span>(prior_draws))]</span>
<span id="cb56-4"><a href="#cb56-4"></a>p <span class="ot">&lt;-</span> <span class="fu">ppc_dens_overlay</span>(<span class="at">y =</span> data<span class="sc">$</span>y, <span class="at">yrep =</span> <span class="fu">as.matrix</span>(y_rep[<span class="dv">1</span><span class="sc">:</span><span class="dv">35</span>, ]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prior-predictive-checks-2" class="slide level2">
<h2>Prior predictive checks</h2>

<img data-src="lec3_files/figure-revealjs/unnamed-chunk-42-1.png" width="960" class="r-stretch"><ul>
<li>Is this reasonable, i.e.&nbsp;consistent with domain expertise?</li>
</ul>
</section>
<section id="data-visualization-as-a-key-component-of-a-principled-bayesian-workflow" class="slide level2">
<h2>Data visualization as a key component of a principled Bayesian workflow</h2>
<ul>
<li>Principled Bayesian workflow is an iterative process of model building (see Betancourt 2018)</li>
<li>Data visualization is vital to helping us understand the performance of Bayesian models (Gabry et al.&nbsp;2019)
<ul>
<li><em>There are more checks we haven’t yet done</em></li>
</ul></li>
<li>In general, need to get good at this stuff if you intend to learn or use Bayesian statistics</li>
<li>If you don’t use these tools, you do so at your own risk</li>
</ul>
</section>
<section id="summary-and-outlook" class="slide level2">
<h2>Summary and outlook</h2>
<ul>
<li>A presumption…</li>
<li>We built a linear regression model in Stan, ran it with vague priors</li>
<li>Spent a substantial amount of time going through diagnostics
<ul>
<li>Split these into MCMC checks and model fit checks</li>
</ul></li>
<li>Spent a great deal of time walking through Bayesian model visualization
<ul>
<li>Touched on how visualization is a core part of a modern Bayesian workflow</li>
</ul></li>
<li>Moving foward, Generalized Linear Models (GLMs)</li>
</ul>
</section>
<section id="references" class="slide level2">
<h2>References</h2>
<div style="font-size:25px">
<ol type="1">
<li><p>Betancourt 2017. <a href="https://arxiv.org/abs/1701.02434">A conceptual introduction to Hamiltonian Monte Carlo</a></p></li>
<li><p>Vehtari et al.&nbsp;2019. <a href="https://arxiv.org/pdf/1903.08008.pdf">Rank-normalization, folding, and localization: An improved R-hat for assessing convergence of MCMC*</a></p></li>
<li><p>Gabry et al.&nbsp;2019. <a href="https://academic.oup.com/jrsssa/article/182/2/389/7070184">Visualization in Bayesian workflow</a></p></li>
<li><p>Gelman et al.&nbsp;2021. Bayesian Data Analysis. Edition 3.</p></li>
<li><p>Kery and Schaub. 2012. Bayesian Population Analysis using WinBUGS.</p></li>
<li><p>McElreath 2023. Statistical Rethinking. Second Edition.</p></li>
<li><p><a href="https://mc-stan.org/docs/stan-users-guide/index.html">Stan documentation</a></p></li>
</ol>
</div>
</section>
<section id="exercises" class="slide level2">
<h2>Exercises:</h2>
<div style="font-size:25px">
<ol type="1">
<li><p>Calculate the posterior predictive distribution one might expect for y if they went out and collected data at <span class="math inline">\(x_{i} = 1.23\)</span></p></li>
<li><p>Plot the median fit +/- 95% credible intervals from the posterior predictive distribution of y vs.&nbsp;<span class="math inline">\(x_{i}\)</span>. Can you think of other ways to visualize fits vs.&nbsp;data and the corresponding uncertainty in these fits?</p></li>
<li><p>Repeat the exercises in this presentation by first simulating your own linear regression dataset to prove to yourself that your code is returning reasonable answers.</p></li>
<li><p>Assume this dataset represents the relationship between a measure of a stream contaminant (y) and a metric of industrial development (x). Through an extensive structured decision making process it was determined by industrial representatives, resource managers, subject matter experts, and Indigenous Rightsholders that if this relationship indicated that <span class="math inline">\(\beta_{1}\)</span> exceeded 0.71 with <span class="math inline">\(\text(Pr &gt; 0.35)\)</span> streamside development should be ceased. What does your analysis suggest? What are the limitations of your analysis, including things that might influence your assessment of <span class="math inline">\(\Pr(\beta_{1} &gt; 0.71)\)</span>? Take care to seperate explanation vs.&nbsp;advocacy.</p></li>
<li><p>Someone in the structured decision making group hates the word probability, and is pointing out that it isn’t even clear what is meant by <span class="math inline">\(\Pr(\beta_{1} &gt; 0.71)\)</span>. Can you think of a metaphor for describing this uncertainty that does not use the word probability and which is easily understandable by folks who may lack technical training?</p></li>
</ol>
</div>
<div class="footer footer-default">

</div>
</section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="lec3_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="lec3_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="lec3_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="lec3_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="lec3_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="lec3_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="lec3_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="lec3_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="lec3_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="lec3_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        text: function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>