<!DOCTYPE html>
<html lang="en"><head>
<script src="lec6_files/libs/clipboard/clipboard.min.js"></script>
<script src="lec6_files/libs/quarto-html/tabby.min.js"></script>
<script src="lec6_files/libs/quarto-html/popper.min.js"></script>
<script src="lec6_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="lec6_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="lec6_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="lec6_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="lec6_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.4.330">

  <meta name="author" content="Christopher Cahill">
  <meta name="dcterms.date" content="2023-09-18">
  <title>Fitting nonlinear ecological models in Stan</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="lec6_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="lec6_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        background-color: #ffffff;
        color: #a0a0a0;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #a0a0a0;  padding-left: 4px; }
    div.sourceCode
      { color: #1f1c1b; background-color: #ffffff; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #1f1c1b; } /* Normal */
    code span.al { color: #bf0303; background-color: #f7e6e6; font-weight: bold; } /* Alert */
    code span.an { color: #ca60ca; } /* Annotation */
    code span.at { color: #0057ae; } /* Attribute */
    code span.bn { color: #b08000; } /* BaseN */
    code span.bu { color: #644a9b; font-weight: bold; } /* BuiltIn */
    code span.cf { color: #1f1c1b; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #924c9d; } /* Char */
    code span.cn { color: #aa5500; } /* Constant */
    code span.co { color: #898887; } /* Comment */
    code span.cv { color: #0095ff; } /* CommentVar */
    code span.do { color: #607880; } /* Documentation */
    code span.dt { color: #0057ae; } /* DataType */
    code span.dv { color: #b08000; } /* DecVal */
    code span.er { color: #bf0303; text-decoration: underline; } /* Error */
    code span.ex { color: #0095ff; font-weight: bold; } /* Extension */
    code span.fl { color: #b08000; } /* Float */
    code span.fu { color: #644a9b; } /* Function */
    code span.im { color: #ff5500; } /* Import */
    code span.in { color: #b08000; } /* Information */
    code span.kw { color: #1f1c1b; font-weight: bold; } /* Keyword */
    code span.op { color: #1f1c1b; } /* Operator */
    code span.ot { color: #006e28; } /* Other */
    code span.pp { color: #006e28; } /* Preprocessor */
    code span.re { color: #0057ae; background-color: #e0e9f8; } /* RegionMarker */
    code span.sc { color: #3daee9; } /* SpecialChar */
    code span.ss { color: #ff5500; } /* SpecialString */
    code span.st { color: #bf0303; } /* String */
    code span.va { color: #0057ae; } /* Variable */
    code span.vs { color: #bf0303; } /* VerbatimString */
    code span.wa { color: #bf0303; } /* Warning */
  </style>
  <link rel="stylesheet" href="lec6_files/libs/revealjs/dist/theme/quarto.css">
  <link rel="stylesheet" href="https://qfcatmsu.github.io/css/presStyle.css">
  <link href="lec6_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="lec6_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="lec6_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="lec6_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    padding-bottom: 0.5rem;
    margin-bottom: 0;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-image="https://qfcatmsu.github.io/Images/dark-big.png" data-background-position="6% 95%" data-background-size="40%" class="quarto-title-block center">
  <h1 class="title">Fitting nonlinear ecological models in Stan</h1>
  <p class="subtitle">FW 891 <br> <a href="https://qfcatmsu.github.io/FW-Bayes/week4/lec6.html" style="position:absolute;top:40%;left:35%;font-size:20px;">Click here to view presentation online</a></p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Christopher Cahill 
</div>
</div>
</div>

  <p class="date">18 September 2023</p>
</section>
<section id="purpose" class="slide level2">
<h2>Purpose</h2>
<ul>
<li>Introduce nonlinear models</li>
<li>Demonstrate how those models can be powerful for answering bespoke resource management questions</li>
<li>Demonstrate some tricks for fitting nonlinear models</li>
<li>Gain familiarity with non-standard models and estimating them in Stan</li>
</ul>
</section>
<section id="nonlinear-modeling-is-like-wandering-down-a-sketchy-alley-with-no-end-in-sight" class="slide level2">
<h2>Nonlinear modeling is like wandering down a sketchy alley with no end in sight</h2>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/sketch.png" width="700" height="500"></p>
</figure>
</div>
</section>
<section id="however" class="slide level2">
<h2>However…</h2>
<ul>
<li>Bespoke ecological relationships critical for answering management relevant questions
<ul>
<li>Building models for a specific problem at hand rather than shoe-horning a dataset into an easy modeling framework</li>
<li>Often yields important insights into ecology and hence for resource mgmt</li>
<li>Many agency-collected datasets have been scoured by analysts using simpler linear modeling tools (GLM, GLMM), so nonlinear modeling is often a powerful way to look at old datsets through fresh eyes</li>
</ul></li>
</ul>
<p><span class="footerRight">see Cahill et al.&nbsp;2018; Cahill et al.&nbsp;2022</span></p>
</section>
<section id="what-is-a-nonlinear-model" class="slide level2">
<h2>What is a nonlinear model</h2>
<ul>
<li><p>A nonlinear model is a model in which the predicted values are nonlinear functions of the parameters, not necessarily of the predictor variables</p></li>
<li><p>This is a linear model because y is a linear function of a, b, and c even though it is a nonlinear function of x:</p></li>
</ul>
<p><span class="math display">\[
y = a + bx + cx^2
\]</span></p>
<ul>
<li>Whereas the following power-law is a nonlinear model: <span class="math display">\[
y = ax^b
\]</span></li>
</ul>
<p><span class="footerRight">Bolker et al.&nbsp;2013</span></p>
</section>
<section id="linearizing-the-model-via-algebra" class="slide level2">
<h2>Linearizing the model via algebra</h2>
<ul>
<li><p>We could linearize the previous equation by taking logarithms <span class="math display">\[
log(y) = log(a) + b \cdot log(x)
\]</span></p></li>
<li><p>We could solve the nonlinear equation on the previous slide using something like <code>nls()</code> or via the linear model above using <code>lm()</code> in R</p></li>
<li><p>However:</p>
<ul>
<li>Nonlinear version assumes a constant standard deviation and the linear version assumes a constant coefficient of variation</li>
</ul></li>
</ul>
</section>
<section id="where-do-nonlinear-model-equations-come-from" class="slide level2">
<h2>Where do nonlinear model equations come from?</h2>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/stork.png" width="700" height="500"></p>
</figure>
</div>
</section>
<section id="where-do-nonlinear-model-equations-come-from-1" class="slide level2">
<h2>Where do nonlinear model equations come from?</h2>
<ul>
<li>Often (but not always) formulated based on biological first principles
<ul>
<li>Typically represented as something like a differential equation (examples: Predator-prey models, Stock-Recruitment models, Somatic Growth models, logistic population growth, meta-population models, etc.)</li>
<li>This means that estimating the parameters of these models is more likely to yield ecologically relevant insights</li>
</ul></li>
</ul>
<p><span class="footerRight">see examples in Ricker 1954; Beverton and Holt 1957; Brännström and Sumpter 2005</span></p>
</section>
<section id="deriving-a-nonlinear-model-an-example" class="slide level2">
<h2>Deriving a nonlinear model: an example</h2>
<ul>
<li>The von Bertalanffy growth model is often used to report fish growth patterns
<ul>
<li>Derived from a bioenergetics model: <span class="math display">\[
\frac{\mathrm{d} W}{\mathrm{~d} t}=H W_{t}^{\frac{2}{3}}-m W_{t}
\]</span></li>
</ul></li>
</ul>
<p>where W is weight at time t, H and m are mass-specific anabolic (tissue building) and catabolic (breaking down tissue) terms</p>
<p><span class="footerRight">Beverton and Holt 1957</span></p>
</section>
<section id="deriving-a-nonlinear-model-an-example-1" class="slide level2">
<h2>Deriving a nonlinear model: an example</h2>
<p>Solving that differential equation, and transforming from weight to length yields the von Bertalanffy growth model:</p>
<p><span class="math display">\[
\hat{l}_{i}=l_{\infty}\left\{1-\mathrm{e}^{\left[-(K)\left(a_{i}-t_{0}\right)\right]}\right\}
\]</span></p>
<ul>
<li>where <span class="math inline">\(a_{i}\)</span> and <span class="math inline">\(\hat{l}_{i}\)</span> are the age and predicted length of fish i</li>
<li><span class="math inline">\(l_{\infty}\)</span> is a parameter that represents the average asymptotic maximum length of fish</li>
<li>K is the unitless Brody “growth” coefficient</li>
<li>t0 is a nuisance parameter that describes age when length is hypothetically zero</li>
</ul>
</section>
<section id="visualizing-that-model-in-r" class="slide level2">
<h2>Visualizing that model in R</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>ages <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">25</span> <span class="co"># vector of ages</span></span>
<span id="cb1-2"><a href="#cb1-2"></a>K <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb1-3"><a href="#cb1-3"></a>t0 <span class="ot">&lt;-</span> <span class="fl">0.0</span></span>
<span id="cb1-4"><a href="#cb1-4"></a>Linf <span class="ot">&lt;-</span> <span class="dv">575</span></span>
<span id="cb1-5"><a href="#cb1-5"></a>lengths <span class="ot">&lt;-</span> Linf<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">exp</span>(<span class="sc">-</span>K<span class="sc">*</span>(ages<span class="sc">-</span>t0))) </span>
<span id="cb1-6"><a href="#cb1-6"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">length =</span> lengths, <span class="at">age =</span> ages)</span>
<span id="cb1-7"><a href="#cb1-7"></a></span>
<span id="cb1-8"><a href="#cb1-8"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb1-9"><a href="#cb1-9"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> length)) <span class="sc">+</span> </span>
<span id="cb1-10"><a href="#cb1-10"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">600</span>) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"steelblue"</span>, <span class="at">lwd =</span> <span class="fl">2.5</span>) <span class="sc">+</span> <span class="fu">theme_qfc</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="lec6_files/figure-revealjs/unnamed-chunk-2-1.png" width="960" class="r-stretch"></section>
<section id="visualizing-the-model" class="slide level2">
<h2>Visualizing the model</h2>

<img data-src="images/vonB1.png" style="width:185px; position: absolute; margin-top:-5%; right:10%; z-index:-1;" class="r-stretch"><p><span class="footerRight">Figure credit: Jim Bence</span></p>
</section>
<section id="visualizing-the-model-1" class="slide level2">
<h2>Visualizing the model</h2>

<img data-src="images/vonB2.png" style="width:185px; position: absolute; margin-top:-5%; right:10%; z-index:-1;" class="r-stretch"><p><span class="footerRight">Figure credit: Jim Bence</span></p>
</section>
<section id="why-this-nonlinear-hogwash-is-neat" class="slide level2">
<h2>Why this nonlinear hogwash is neat</h2>
<ul>
<li>The model on the previous slide implies the following</li>
</ul>
<p><span class="math display">\[
l_{\infty}=\frac{H}{m} \cdot \alpha^{-\frac{1}{3}}
\]</span></p>
<p>where <span class="math inline">\(\alpha\)</span> is the shape parameter from a weight-length relationship, and</p>
<p><span class="math display">\[
K=\frac{m}{3}
\]</span></p>
<p>so it allows us to explicitly model the ecological processes we are interested in if we are clever!</p>
</section>
<section id="some-challenges-associated-with-nonlinear-modeling" class="slide level2">
<h2><em>Some</em> challenges associated with nonlinear modeling</h2>
<div style="font-size:30px">
<ul>
<li>Requires a better handle on both math/calculus and numerical computing</li>
<li>Need to understand the properties of a variety of probability distributions and deterministic response functions (Link and Barber 2010; Bolker et al.&nbsp;2013)
<ul>
<li>Even after a model has been properly formulated, it can be difficult to fit to data and estimate parameters</li>
<li>No gaurantees of global optimum, which means model checking and priors even more important</li>
</ul></li>
<li>There is no “dummies” guide to nonlinear ecological model fitting</li>
<li>Critical to have good starting values, priors, tests with simulated data, etc.</li>
</ul>
</div>
<p><img data-src="images/despair.png" style="width:185px; position: absolute; margin-top:3%; left:42%;"></p>
<p><img data-src="images/depression.png" style="width:185px; position: absolute; margin-top:-1%; left:0%;"></p>
<p><span class="footerRight">see Bolker et al.&nbsp;2013</span></p>
</section>
<section id="advice-from-bolker-et-al.-2013" class="slide level2">
<h2>Advice (from Bolker et al.&nbsp;2013)</h2>
<ul>
<li>Most complex models are extensions of simpler models
<ul>
<li>Thus, often makes sense to fit reduced versions of the model and build up working code blocks</li>
<li>Can use reduced models to get good starting values for more complex models in some cases</li>
</ul></li>
<li>Choose a subset of your data that makes your code run fast during the debugging stage</li>
<li>Keep It Simple Stupid (KISS), at least to start</li>
</ul>

<img data-src="images/kiss.png" style="width:185px; position: absolute; margin-top:40%; right:0%;" class="r-stretch"></section>
<section id="advice-contd-gelman-and-hill-2006" class="slide level2">
<h2>Advice cont’d (Gelman and Hill 2006)</h2>
<p><br> <em>“Our general approach to finding problems in statistical modeling software is to get various crude models or models with no predictors to work and then gradually build up to the model we want to fit. If you set up a complicated model and you cannot get it to run (or it does and its results do not make sense) then either build it up from scratch or strip it down until you can get it to work and make sense”</em></p>
</section>
<section id="unidentifiability-bolker-2009" class="slide level2">
<h2>Unidentifiability (Bolker 2009)</h2>
<ul>
<li>In extreme cases, may try to fit <em>unidentifiable</em> models
<ul>
<li>These are models that cannot, either in principle or more often in practice, be fitted at all with the available data</li>
</ul></li>
<li>Happens to inexperienced/enthusiastic modelers, but also experts</li>
<li>Use common sense (thinking about your model) and do model checks</li>
<li>Simulated data can help us better understand a model, too</li>
</ul>
</section>
<section id="specific-suggestions-to-overcome-problems" class="slide level2">
<h2>Specific suggestions to overcome problems</h2>
<div style="font-size:30px">
<ul>
<li>Initially omit complexities of the model as much as possible (random effects, zero inflation, imprefect detection)</li>
<li>Hold some parameters constant or set strong priors to restrict parameters to a narrow range</li>
<li>Reduce the model to a simpler form by setting some parameters, especially exponents or shape parameters, to null values
<ul>
<li>e.g., try a Poisson model before a negative binomial model</li>
<li>or an exponential suvival model before a Gamma model</li>
</ul></li>
</ul>
</div>
<p><span class="footerLeft">Bolker et al.&nbsp;2013</span></p>

<img data-src="images/detective.png" style="width:185px; position: absolute;margin-top:-4%; right:0%;" class="r-stretch"></section>
<section id="pick-reasonable-starting-values" class="slide level2">
<h2>Pick reasonable starting values</h2>
<ul>
<li>Starting the optimization or simulation routine sufficiently close to the best values often makes the difference between success and failure</li>
<li>Stan doesn’t require you to pick starting values (it will do so for you), but…</li>
<li>Most important step: make sure initial parameter values are on the right order of magnitude
<ul>
<li>For parameters that are very uncertain, estimating the logarithms of the original parameters can be helpful</li>
<li>Plot the data and eyeball initial values, overlay predictions for initial values on the data</li>
</ul></li>
</ul>
<p><span class="footerRight">Bolker et al.&nbsp;2013</span></p>
</section>
<section id="reshape-the-goodness-of-fit-surface" class="slide level2">
<h2>Reshape the goodness of fit surface</h2>
<ul>
<li>Think of the problem geometrically, as an attempt to map out the posterior surface
<ul>
<li>Posterior geometry is a function of priors, model structure, and the information content within your data</li>
</ul></li>
<li>One can often improve the shape of the posterior, and hence the stability and efficiency of Stan (or other software platforms) without changing the biological meaning of the model or its goodness of fit
<ul>
<li>Reparameterization may be unnecessary, helpful, or essential to solving a specific problem</li>
</ul></li>
</ul>
<p><span class="footerRight">Bolker et al.&nbsp;2013</span></p>
</section>
<section id="simulation" class="slide level2">
<h2>Simulation</h2>
<ul>
<li>Mentioned this before, but simulation is perhaps the single most valuable tool for debugging complex models</li>
<li>Code up the data generating process(DGP), and give your estimation model good data to see if it can recover truth
<ul>
<li>Can reduce data quality to mirror challenges observed or perceived in the real data once you get your model running</li>
<li>Helps you find bugs, identify unidentifiability, better understand your model, etc.</li>
<li>Critical component of a modern Bayesian workflow, and the best case scenario is that the estimator is able to recover true parameters</li>
</ul></li>
</ul>
<p><span class="footerRight">Hilborn and Mangel 1997; Gelman et al.&nbsp;2022</span></p>
</section>
<section id="scaling" class="slide level2">
<h2>Scaling</h2>
<ul>
<li>Parameters with strongly different scales lead to likelihood surfaces with different slopes or curvatures in different directions
<ul>
<li>Often causes numerical problems</li>
</ul></li>
<li>Rescaling parameters by appropriate constants can imrpove robustness of fit</li>
<li>Researchers often scale predictor variables by standard deviation</li>
<li>See this link:
<ul>
<li><a href="https://mc-stan.org/docs/stan-users-guide/standardizing-predictors-and-outputs.html" class="uri">https://mc-stan.org/docs/stan-users-guide/standardizing-predictors-and-outputs.html</a></li>
</ul></li>
</ul>
<p><span class="footerRight">Bolker et al.&nbsp;2013</span></p>
</section>
<section id="remove-correlation-in-the-likelihood-surface" class="slide level2">
<h2>Remove correlation in the likelihood surface</h2>
<ul>
<li>Strongly correlated likelihood surfaces can be difficult for MCMC algorithms</li>
<li>One simple strategy:
<ul>
<li>Centering predictor variables, by subracting their mean or something near the center of the distribution of the predictor variable</li>
<li>Centering redefines the intercept or reference level of the model and strongly reduces correlation between slope and intercept parameters</li>
<li>Also improves interpretability <span class="footerRight">Bolker et al.&nbsp;2013</span></li>
</ul></li>
</ul>
</section>
<section id="in-class-examples" class="slide level2">
<h2>In class examples</h2>
<ol type="1">
<li><p>von Bertalanffy model to estimate fish growth (fake data where I know truth but you do not; <em>easy</em>)</p></li>
<li><p>Type-II predator-prey model for wolves and moose (real data from Isle Royale; <em>intermediate</em>)</p></li>
<li><p>Schaefer surplus-production model to estimate maximum sustainable yield (real data from south Atlantic Albacore Tuna; <em>hard</em>)</p></li>
</ol>
<p><img data-src="images/wolf.png" style="height:150px; position: absolute; margin-top:0%; left:5%;"></p>
<p><img data-src="images/tuna.png" style="height:150px; position: absolute; margin-top:0%; left:35%;"></p>
<p><img data-src="images/moose.png" style="height:150px; position: absolute; margin-top:0%; right:5%;"></p>
</section>
<section id="the-von-bertalanffy-growth-model" class="slide level2">
<h2>The von Bertalanffy growth model</h2>

<img data-src="images/fish.png" style="width:175px; position: absolute; margin-top:0%; right:10%;" class="r-stretch"></section>
<section id="the-von-bertalanffy-growth-model-1" class="slide level2">
<h2>The von Bertalanffy growth model</h2>
<ul>
<li><p>Will a 21 inch minimum length limit work?</p></li>
<li><p><a href="https://github.com/QFCatMSU/FW-Bayes/blob/main/week4/data/age_length.rds?raw=true">The walleye data</a></p></li>
<li><p>The model: <span class="math display">\[
\begin{array}{l}
L_{i}=L_{\infty}\left(1-e^{-K\left(a_{i}-t_{0}\right)}\right)+\varepsilon_{i} \\
\varepsilon_{i} \stackrel{i i d}{\sim} N\left(0, \sigma^{2}\right)
\end{array}
\]</span></p></li>
<li><p>Fit this model using Stan</p></li>
<li><p>Evaluate your model</p></li>
</ul>
<p><img data-src="images/fish.png" style="height: 150px; position: absolute; margin-top:-15%; right:10%;"></p>
</section>
<section id="predator-prey-models" class="slide level2">
<h2>Predator-prey models</h2>
<p><img data-src="images/wolf.png" style="width:185px; position: absolute; margin-top:5%; left:10%;"> <img data-src="images/moose.png" style="width:300px; height:300px; position: absolute; margin-top:10%; right:10%;"></p>
</section>
<section id="isle-royale-wolf-moose-dynamics" class="slide level2">
<h2>Isle Royale Wolf-Moose dynamics</h2>
<ul>
<li>During the winter of 1948-49, an adventurous band of timber wolves set out from Minnesota’s north shore, crossed the Lake Superior ice, and arrived on Isle Royale
<ul>
<li>No harvest of wolves or moose on Isle Royale</li>
<li>One of the only places wolves survived by the 1960s in the lower 48</li>
</ul></li>
<li>Wolf-moose dynamics on Isle Royale have contributed immeasurable information on wolf ecology and predator-prey dynamics</li>
</ul>
<p><span class="footerRight">Wydeven et al.&nbsp;2009</span></p>
</section>
<section id="the-isle-royale-natural-experiment" class="slide level2">
<h2>The Isle Royale natural experiment</h2>

<img data-src="images/isleroyale.png" style="width:185px; position: center;" class="r-stretch"></section>
<section id="predator-prey-models-background" class="slide level2">
<h2>Predator-prey models: Background</h2>
<ul>
<li>During the 1950s Buzz Holling conducted experiments to investigate how a predator’s rate of prey capture is related to prey density
<ul>
<li>This is called a <em>functional response</em></li>
</ul></li>
<li>Simplest functional response (Type I) relates capture rate C and prey density N via a linear relationship:</li>
</ul>
<p><span class="math display">\[
C=\alpha N
\]</span></p>
<p>where <span class="math inline">\(\alpha\)</span> is a proportionality set by the rate at which predators encounter prey</p>
<p><span class="footerRight">Holling 1959a, b</span></p>
</section>
<section id="predator-prey-models-background-1" class="slide level2">
<h2>Predator-prey models: Background</h2>
<ul>
<li>Type I dynamics ignore an important aspect of the ecology: handling time</li>
<li>So Buzz sat down and derived a so-called Type-II predator-prey relationship (using calculus) that accounted for handling time <em>h</em>:</li>
</ul>
<p><span class="math display">\[
C=\frac{\alpha N}{1+\alpha h N}
\]</span></p>
<ul>
<li>where <em>h</em> begins when the predator finds the prey item and ends when the time the prey item is eaten</li>
</ul>
<p><span class="footerRight">Holling 1959b</span></p>
</section>
<section id="type-ii-functional-response" class="slide level2">
<h2>Type-II functional response</h2>
<div style="font-size:36px">
<ul>
<li><p>What is the handling time for a wolf kill on Isle Royale?</p></li>
<li><p><a href="https://github.com/QFCatMSU/FW-Bayes/blob/main/week4/data/moose.csv?raw=true">The wolf-moose data</a></p></li>
<li><p>The model: <span class="math display">\[
\begin{array}{l}
C_{i}=\frac{\alpha N_{i}}{1+\alpha h N_{i}}+\varepsilon_{i} \\
\varepsilon_{i} \stackrel{i i d}{\sim} N\left(0, \sigma^{2}\right)
\end{array}
\]</span></p></li>
<li><p>where <em>i</em> represents an observed moose density <span class="math inline">\(N_{i}\)</span> and a corresponding obsrvation of kills per wolf <em>per month</em> <span class="math inline">\(C_{i}\)</span></p></li>
<li><p>In groups of &lt; 3, fit the model and evaluate MCMC algorithm and fit</p></li>
<li><p>How hard do you want the problem to be?</p></li>
</ul>
</div>
</section>
<section id="tuna-sustainability-in-the-south-atlantic" class="slide level2">
<h2>Tuna sustainability in the south Atlantic</h2>

<img data-src="images/tuna.png" style="width:185px; position: center;" class="r-stretch"></section>
<section id="tuna-sustainability-background" class="slide level2">
<h2>Tuna sustainability: background</h2>
<ul>
<li>There are many models that are used to assess the sustainability of fish stocks</li>
<li>Simplest of these is the Schaefer surplus production model, which is based on the logistic population growth model</li>
<li>Main idea behind this models is that population productivity (and hence harvest) is maximized at some intermediate population level because of density dependence in either per capita birth or death rates</li>
</ul>
<p><span class="footerRight">Beverton and Holt 1957</span></p>
</section>
<section id="the-schaefer-model" class="slide level2">
<h2>The Schaefer model</h2>
<p><span class="math display">\[
\begin{aligned}
B_{0} &amp; = K \\
B_{t+1} &amp; =B_{t}+r B_{t}\left(1-\frac{B_{t}}{K}\right)-C_{t}
\end{aligned}
\]</span></p>
<ul>
<li>K is carrying capacity</li>
<li>r is the intrinsic population growth rate</li>
<li><span class="math inline">\(B_{t}\)</span> and <span class="math inline">\(C_{t}\)</span> is biomass and fishery catch (in biomass units) in year t</li>
<li>Note <span class="math inline">\(B_{0}\)</span> need not be set at K</li>
</ul>
<p><span class="footerRight">Beverton and Holt 1957; Hilborn and Mangel 1997</span></p>
</section>
<section id="schaefer-model-continued" class="slide level2">
<h2>Schaefer model continued</h2>
<div style="font-size:25px">
<ul>
<li><p>To relate the model to data we rely on the fact that <span class="math display">\[
\hat{I}_{t}=\frac{C_{t}}{E_{t}}=q B_{t}
\]</span></p></li>
<li><p><span class="math inline">\(\hat{I}_{t}\)</span> is the predicted value of the index of relative abundance in year t</p></li>
<li><p><span class="math inline">\(E_{t}\)</span> is the harvesting effort in year t</p></li>
<li><p>q is catchability coefficient, defined as the amount of biomass/catch taken with one unit of effort</p></li>
<li><p>Catch per unit effort (CPUE = <span class="math inline">\(\frac{C_{t}}{E_{t}}\)</span>) can then be related to a survey index or fishery catches via a lognormal likelihood function:</p></li>
</ul>
<p><span class="math display">\[
log(CPUE_{t}) \stackrel{i i d}{\sim} N\left(log(q) + log(B_{t}), \tau^{2}\right)
\]</span></p>
<ul>
<li>Note <span class="math inline">\(B_{t}\)</span> is calculated via the dynamic equation on the previous slide, and that <span class="math inline">\(log(\frac{C_{t}}{E_{t}}) = log(q) + log(B_{t})\)</span></li>
</ul>
</div>
</section>
<section id="cool-things-about-the-schaefer-model" class="slide level2">
<h2>Cool things about the Schaefer model</h2>
<div style="font-size:32px">
<ul>
<li><p>Maximum sustainable yield (MSY) is the largest yield (or catch) that can be taken from a species’ stock over an indefinite period (theoretically)</p></li>
<li><p>Easy to determine MSY with this model: <span class="math display">\[
MSY = r \cdot K/4
\]</span></p></li>
<li><p>And can also kick out the corresponding harvesting effort that would achieve MSY: <span class="math display">\[
EMSY = r / (2 \cdot q)
\]</span></p></li>
<li><p>Because we are Bayesian we can kick these management quantities out as derived variables</p></li>
</ul>
</div>
<p><span class="footerRight">Beverton and Holt 1957; Hilborn and Mangel 1997</span></p>
</section>
<section id="the-problem" class="slide level2">
<h2>The problem</h2>
<ul>
<li>Estimate MSY for a south Atlantic albacore tuna fishery</li>
<li><a href="https://github.com/QFCatMSU/FW-Bayes/blob/main/week4/data/tuna_data.csv?raw=true">The tuna data</a></li>
<li>Relate the index of fishery CPUE to fishery catches via the Schaefer model</li>
<li>Some trickery needed to get this miserable thing going in Stan, including special care with priors</li>
<li>Let’s go through this thing together</li>
<li>See also Millar and Meyer 2000 for specific prior choices</li>
</ul>
</section>
<section id="recap" class="slide level2">
<h2>Recap</h2>
<ul>
<li>We have introduced nonlinear models</li>
<li>Hopefully it has been conveyed that these things are tricksy, but really critical for many important ecological and resource mgmt problems</li>
<li>Up next…</li>
</ul>
<p><img data-src="images/smegol.png" style="height:300px; position: absolute;margin-top:-2%; right:40%;"></p>
</section>
<section id="references" class="slide level2">
<h2>References</h2>
<div style="font-size:20px">
<p>Beverton and Holt. 1957. On the dynamics of exploited fish populations. Chapman and Hall.</p>
<p>Bolker, B. 2009. Learning hierarchical models: advice for the rest of us. Ecological Applications, 19, 588–592.</p>
<p>Bolker et al.&nbsp;2013. Strategies for fitting nonlinear ecological models in R, AD Model Builder, and BUGS. Methods in Ecology and Evolution. doi: 10.1111/2041-210X.12044</p>
<p>Brännström and Sumpter. 2005. The role of competition and clustering in population dynamics. Proceedings of the Royal Society B. doi: https://doi.org/10.1098/rspb.2005.3185</p>
<p>Cahill et al.&nbsp;2018. Multiple challenges confront a high effort inland recreational fishery in decline. Canadian Journal of Fisheries and Aquatic Sciences.</p>
<p>Cahill et al.&nbsp;2022. Unveiling the recovery dynamics of walleye after the invisible collapse. Canadian Journal of Fisheries and Aquatic Sciences.</p>
<p>Gelman and Hill 2006. Data Analysis Using Regression and Multilevel/Hierarchical Models.</p>
<p>Gelman et al.&nbsp;2020. Regression and other stories. Cambridge University Press.</p>
<p>Hilborn and Mangel 1997. The Ecological Detective.</p>
<p>Holling, C. S. 1959a. The components of predation as revealed by a study of small mammal predation of the European pine sawfly. Canadian Entomology 91:293–320</p>
<p>Holling, C. S. 1959b. Some characteristics of simple types of predation and parasitism. Canadian Entomology 91:385–398.</p>
</div>
</section>
<section id="references-1" class="slide level2">
<h2>References</h2>
<div style="font-size:20px">
<p>Link and Barber 2010. Bayesian inference with ecological applications. Academic Press.</p>
<p>Millar and Meyer 2000. Nonlinear state space modeling of fisheries biomass dynamics by using Metropolis-Hastings within-Gibbs sampling. Appl. Statist. 49:327-342.</p>
<p>Monnahan et al.&nbsp;2017. Faster estimation of Bayesian models in ecology using Hamiltonian Monte Carlo. Methods in Ecology and Evolution.</p>
<p>Wydeven et al.&nbsp;2009. Recovery of Gray Wolves in the Great Lakes Region of the United States. Springer.</p>
</div>
<div class="footer footer-default">

</div>
</section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="lec6_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="lec6_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="lec6_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="lec6_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="lec6_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="lec6_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="lec6_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="lec6_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="lec6_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="lec6_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        text: function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>