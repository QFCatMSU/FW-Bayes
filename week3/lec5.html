<!DOCTYPE html>
<html lang="en"><head>
<script src="lec5_files/libs/clipboard/clipboard.min.js"></script>
<script src="lec5_files/libs/quarto-html/tabby.min.js"></script>
<script src="lec5_files/libs/quarto-html/popper.min.js"></script>
<script src="lec5_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="lec5_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="lec5_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="lec5_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="lec5_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.4.322">

  <meta name="author" content="Christopher Cahill">
  <meta name="dcterms.date" content="2023-09-13">
  <title>Runtime warnings, errors, and debugging in R and Stan</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="lec5_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="lec5_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        background-color: #ffffff;
        color: #a0a0a0;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #a0a0a0;  padding-left: 4px; }
    div.sourceCode
      { color: #1f1c1b; background-color: #ffffff; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #1f1c1b; } /* Normal */
    code span.al { color: #bf0303; background-color: #f7e6e6; font-weight: bold; } /* Alert */
    code span.an { color: #ca60ca; } /* Annotation */
    code span.at { color: #0057ae; } /* Attribute */
    code span.bn { color: #b08000; } /* BaseN */
    code span.bu { color: #644a9b; font-weight: bold; } /* BuiltIn */
    code span.cf { color: #1f1c1b; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #924c9d; } /* Char */
    code span.cn { color: #aa5500; } /* Constant */
    code span.co { color: #898887; } /* Comment */
    code span.cv { color: #0095ff; } /* CommentVar */
    code span.do { color: #607880; } /* Documentation */
    code span.dt { color: #0057ae; } /* DataType */
    code span.dv { color: #b08000; } /* DecVal */
    code span.er { color: #bf0303; text-decoration: underline; } /* Error */
    code span.ex { color: #0095ff; font-weight: bold; } /* Extension */
    code span.fl { color: #b08000; } /* Float */
    code span.fu { color: #644a9b; } /* Function */
    code span.im { color: #ff5500; } /* Import */
    code span.in { color: #b08000; } /* Information */
    code span.kw { color: #1f1c1b; font-weight: bold; } /* Keyword */
    code span.op { color: #1f1c1b; } /* Operator */
    code span.ot { color: #006e28; } /* Other */
    code span.pp { color: #006e28; } /* Preprocessor */
    code span.re { color: #0057ae; background-color: #e0e9f8; } /* RegionMarker */
    code span.sc { color: #3daee9; } /* SpecialChar */
    code span.ss { color: #ff5500; } /* SpecialString */
    code span.st { color: #bf0303; } /* String */
    code span.va { color: #0057ae; } /* Variable */
    code span.vs { color: #bf0303; } /* VerbatimString */
    code span.wa { color: #bf0303; } /* Warning */
  </style>
  <link rel="stylesheet" href="lec5_files/libs/revealjs/dist/theme/quarto.css">
  <link rel="stylesheet" href="https://qfcatmsu.github.io/css/presStyle.css">
  <link href="lec5_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="lec5_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="lec5_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="lec5_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    padding-bottom: 0.5rem;
    margin-bottom: 0;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-image="https://qfcatmsu.github.io/Images/dark-big.png" data-background-position="6% 95%" data-background-size="40%" class="quarto-title-block center">
  <h1 class="title">Runtime warnings, errors, and debugging in R and Stan</h1>
  <p class="subtitle">FW 891 <br> <a href="https://qfcatmsu.github.io/FW-Bayes/week3/lec5.html" style="position:absolute;top:40%;left:35%;font-size:20px;">Click here to view presentation online</a></p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Christopher Cahill 
</div>
</div>
</div>

  <p class="date">13 September 2023</p>
</section>
<section id="purpose" class="slide level2">
<h2>Purpose</h2>
<ul>
<li>Talk through some common errors and warning messages in Stan</li>
<li>Most of this is available on the Stan webpage
<ul>
<li>Can be useful for debugging or improving models</li>
</ul></li>
<li>How I debug Stan files (probably the only way)</li>
<li>How I debug R code (not the only way)</li>
</ul>
</section>
<section id="runtime-warnings-and-convergence-problems-webpage-and-cmdstan-documentation" class="slide level2">
<h2>Runtime warnings and convergence problems webpage and cmdstan documentation:</h2>
<p><br></p>
<p><a href="https://mc-stan.org/misc/warnings.html" class="uri">https://mc-stan.org/misc/warnings.html</a></p>
<p><br></p>
<p><a href="https://mc-stan.org/docs/2_24/cmdstan-guide-2_24.pdf" class="uri">https://mc-stan.org/docs/2_24/cmdstan-guide-2_24.pdf</a></p>
</section>
<section id="overview" class="slide level2">
<h2>Overview</h2>
<ul>
<li>Stan throws a range of diagnostics, and throws warnings or errors for anything suspicious</li>
<li>Some of these are more important than others, but in general having an understanding of these warnings and errors can help you debug models or figure out problems with your model<br>
</li>
<li>Figuring out what’s going on is as much an art as science</li>
</ul>
</section>
<section id="the-folk-theorem-of-statistical-computing" class="slide level2">
<h2>The folk theorem of statistical computing</h2>
<ul>
<li>This is a pithy rule that originated from Andrew Gelman (author of Bayesian Data Analysis). It is paraphrased as</li>
</ul>
<p><br></p>
<p><em>“When you have computational problems, often there is a problem with your model [rather than the software]”</em>—— <a href="https://statmodeling.stat.columbia.edu/2021/03/25/the-folk-theorem-revisited/">Andrew Gelman</a></p>
</section>
<section id="types-of-warnings" class="slide level2">
<h2>Types of warnings</h2>
<ul>
<li>Divergent transitions after warmup</li>
<li>Exceptions thrown when Hamiltonian proposal rejected</li>
<li>R-hat</li>
<li>Bulk and Tail ESS</li>
<li>Maximum treedepth</li>
<li>BFMI low</li>
</ul>
</section>
<section id="divergent-transitions-after-warmup" class="slide level2">
<h2>Divergent transitions after warmup</h2>
<div style="font-size:35px">
<ul>
<li>Probably the most important warning</li>
<li>Commonplace with mixed effects models</li>
<li>Hamiltonian Monte Carlo provides internal checks on efficiency and accuracy
<ul>
<li>These come free, arising from constraints of the physics simulation</li>
</ul></li>
<li>Recall that HMC simulates a frictionless particle
<ul>
<li>In any given transition, total energy at the start of a simulation should be equal to the total energy at the end</li>
<li>When this doesn’t happen, the energy is “divergent”
<ul>
<li>often means the posterior distribution is very steep in some region of parameter space, hard to sample</li>
</ul></li>
</ul></li>
</ul>
<p><span class="footerRight">McElreath 2023</span></p>
</div>
</section>
<section id="divergent-transitions-after-warmup-1" class="slide level2">
<h2>Divergent transitions after warmup</h2>
<div style="font-size:35px">
<ul>
<li>Critical to recognize that divergent transitions cannot be safely ignored if completely reliable inference is desired
<ul>
<li>Proceed at your own risk: you may not be faithfully representing the posterior uncertainty if you ignore DTs</li>
</ul></li>
<li>If you only get a few divergences and good Rhat values and ESS, the resulting posterior is often good enough to move forward</li>
<li>There are cases where a small number of divergences without any pattern in their locations can be shown to be unimportant, but this requires a lot of simulation and math</li>
<li>The bottom line is your inferences may be biased if there are DTs after warmup</li>
</ul>
<p><span class="footerRight"><a href="https://mc-stan.org/docs/reference-manual/divergent-transitions.html">Diagnosing and eliminating divergences</a></span></p>
</div>
</section>
<section id="divergent-transitions-after-warmup-2" class="slide level2">
<h2>Divergent transitions after warmup</h2>
<div style="font-size:30px">
<p>How to deal with DTs:</p>
<ol type="1">
<li>Double check the code (even coding errors can cause DTs)</li>
<li>Increase the adaptation target acceptance statistic, <code>adapt_delta</code>, &gt; 0.8
<ul>
<li>Must be between 0,1, so values &gt;&gt; 0.999 have diminishing returns</li>
<li>The step size used by the numerical integrator underlying Stan is a function of <code>adapt_delta</code>, so this results in a smaller step size and (sometimes) fewer divergences</li>
</ul></li>
<li>If (2) does not work, consider priors or reparameterizing the model
<ul>
<li>Plot the data, hone in on where in the model the divergent transitions are occurring</li>
<li>Lots of pairs plots, divergent transition plots</li>
<li>DTs can indicate many things, and often reveal information about your experimental design or the lack of information content contained in your data</li>
</ul></li>
<li>Weep 😭</li>
</ol>
<p><span class="footerRight"><a href="https://mc-stan.org/misc/warnings.html" class="uri">https://mc-stan.org/misc/warnings.html</a></span></p>
</div>
</section>
<section id="exceptions-thrown-when-hamiltonian-proposal-rejected" class="slide level2">
<h2>Exceptions thrown when Hamiltonian proposal rejected</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>Exception thrown at line <span class="dv">24</span><span class="sc">:</span> normal_log<span class="sc">:</span> Scale parameter is <span class="dv">0</span>, </span>
<span id="cb1-2"><a href="#cb1-2"></a>but must be positive<span class="sc">!</span> </span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="sc">-----</span></span>
<span id="cb1-4"><a href="#cb1-4"></a>Rejecting initial value<span class="sc">:</span></span>
<span id="cb1-5"><a href="#cb1-5"></a>Gradient evaluated at the initial value is not finite.</span>
<span id="cb1-6"><a href="#cb1-6"></a>Stan can’t start sampling from this initial value.<span class="st">`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div style="font-size:30px">
<ul>
<li><p>First warning indicates that the standard deviation parameter of the normal distribution is zero, but it must be positive for Stan to compute the density function</p></li>
<li><p>The second message indicates that the gradient of the target (as computed by Stan’s automatic differention) is infinite, indicating numerical problems somewhere in the model but unfortunately without clear information about where exactly.</p></li>
</ul>
</div>
</section>
<section id="exceptions-thrown-when-hamiltonian-proposal-rejected-1" class="slide level2">
<h2>Exceptions thrown when Hamiltonian proposal rejected</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>Exception thrown at line <span class="dv">24</span><span class="sc">:</span> normal_log<span class="sc">:</span> Scale parameter is <span class="dv">0</span>, </span>
<span id="cb2-2"><a href="#cb2-2"></a>but must be positive<span class="sc">!</span> </span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="sc">-----</span></span>
<span id="cb2-4"><a href="#cb2-4"></a>Rejecting initial value<span class="sc">:</span></span>
<span id="cb2-5"><a href="#cb2-5"></a>Gradient evaluated at the initial value is not finite.</span>
<span id="cb2-6"><a href="#cb2-6"></a>Stan can’t start sampling from this initial value.<span class="st">`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div style="font-size:35px">
<ul>
<li>Note: it is possible that even in a correctly specified model a numerical inaccuracy is occasionally seen, especially during warmup
<ul>
<li>For example, scale parameter with zero lower bound can still become numerically indistinguishable from zero</li>
</ul></li>
</ul>
<p><span class="footerRight"><a href="https://mc-stan.org/misc/warnings.html" class="uri">https://mc-stan.org/misc/warnings.html</a></span></p>
</div>
</section>
<section id="split-widehatr-aka-rhat" class="slide level2">
<h2>Split-<span class="math inline">\(\widehat{R}\)</span> aka Rhat</h2>
<ul>
<li>This statistic compares means and variances of the chains</li>
<li>Remember, we use several chains to make convergence diagnostics easier, starting chains at different starting points</li>
<li>Values &lt; 1.1 often sufficient
<ul>
<li>We remove draws from the beginning of the chains and run the chains long enough so that it is not possible to distinguish where each chain started<br>
</li>
<li>A fair amount of math behind this (see link below)</li>
</ul></li>
</ul>
<p><span class="footerRight"><a href="https://avehtari.github.io/masterclass/slides_rhat_neff.pdf" class="uri">https://avehtari.github.io/masterclass/slides_rhat_neff.pdf</a></span></p>
</section>
<section id="section" class="slide level2">
<h2></h2>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/chains.png" width="900" height="600"></p>
</figure>
</div>
</section>
<section id="some-slides-from-aki-vehtari-on-convergence-to-a-common-posterior" class="slide level2">
<h2>Some slides from Aki Vehtari on convergence to a common posterior</h2>
<p>See here:</p>
<p><a href="https://avehtari.github.io/masterclass/slides_rhat_neff.pdf" class="uri">https://avehtari.github.io/masterclass/slides_rhat_neff.pdf</a></p>
</section>
<section id="nonconvergence" class="slide level2">
<h2>Nonconvergence</h2>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/nonconvergence.png" width="700" height="500"></p>
</figure>
</div>
<p><span class="footerRight"><a href="https://avehtari.github.io/masterclass/slides_rhat_neff.pdf" class="uri">https://avehtari.github.io/masterclass/slides_rhat_neff.pdf</a></span></p>
</section>
<section id="nonconvergence-viewed-another-way" class="slide level2">
<h2>Nonconvergence viewed another way</h2>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/nonconvergence2.png" width="700" height="500"></p>
</figure>
</div>
<p><span class="footerRight"><a href="https://avehtari.github.io/masterclass/slides_rhat_neff.pdf" class="uri">https://avehtari.github.io/masterclass/slides_rhat_neff.pdf</a></span></p>
</section>
<section id="visually-converged-chains" class="slide level2">
<h2>Visually converged chains</h2>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/converged.png" width="700" height="500"></p>
</figure>
</div>
<p><span class="footerRight"><a href="https://avehtari.github.io/masterclass/slides_rhat_neff.pdf" class="uri">https://avehtari.github.io/masterclass/slides_rhat_neff.pdf</a></span></p>
</section>
<section id="high-widehatr-values" class="slide level2">
<h2>High <span class="math inline">\(\widehat{R}\)</span> values</h2>
<div style="font-size:35px">
<ul>
<li>Indicate the chains have not mixed well</li>
<li>Good reasons to NOT think of them as being fully representative of the posterior = bad inference</li>
<li>When there are also DTs in the model, just another symptom of problematic geometry that caused the divergences</li>
<li>If high <span class="math inline">\(\widehat{R}\)</span> without other warnings, often associated with posteriors that have multiple, well-separated modes</li>
<li>Running chains longer may help</li>
</ul>
</div>
<p><span class="footerRight"><a href="https://mc-stan.org/misc/warnings.html" class="uri">https://mc-stan.org/misc/warnings.html</a>; Gelman et al.&nbsp;2003</span></p>
</section>
<section id="bulk-and-tail-effective-sample-size-ess" class="slide level2">
<h2>Bulk and tail Effective Sample Size (ESS)</h2>
<ul>
<li>Roughly speaking, ESS tells you how many independent draws contain the same amount of information as the dependent sample obtained by the MCMC algorithm</li>
<li>Higher is better</li>
<li>For final analyses, Stan recommends bulk-ESS &gt; 100x the number of chains
<ul>
<li>4 chains, want rank-normalized ESS of at least 400</li>
<li>Early in an analysis, ESS &gt; 20 is fine</li>
</ul></li>
</ul>
<p><span class="footerRight"><a href="https://mc-stan.org/misc/warnings.html" class="uri">https://mc-stan.org/misc/warnings.html</a></span></p>
</section>
<section id="bulk-and-tail-effective-sample-size-ess-1" class="slide level2">
<h2>Bulk and tail Effective Sample Size (ESS)</h2>
<ul>
<li>Tail-ESS computes the minimum of the ESS of the 5th and 95th quantiles
<ul>
<li>Warnings about tail-ESS can help diagnose slow mixing in the tails</li>
</ul></li>
<li>These warnings are often accompanied by large <span class="math inline">\(\widehat{R}\)</span> values</li>
<li>Useful quick summary, but for final results it can be useful to check Monte Carlo standard error for quantities of interest (not shown)</li>
<li>Introduce thinning, and the only reason to do it</li>
</ul>
<p><span class="footerRight"><a href="https://mc-stan.org/docs/reference-manual/effective-sample-size.html" class="uri">https://mc-stan.org/docs/reference-manual/effective-sample-size.html</a></span></p>
</section>
<section id="maximum-treedepth-warnings" class="slide level2">
<h2>Maximum treedepth warnings</h2>
<div style="font-size:35px">
<ul>
<li>Not as serious as other warnings
<ul>
<li>DTs, high <span class="math inline">\(\widehat{R}\)</span> and low ESS are a <em>validity</em> concern</li>
<li>Maximum treedepth warnings are an <em>efficiency</em> concern</li>
</ul></li>
<li>Configuring the NUTS sampler (variant of HMC used by Stan) involves putting a cap on the number of simulation steps it evaluates during each iteration
<ul>
<li>This is controlled by the <code>max_treedepth</code> parameter, where maximum number of steps = 2^<code>max_treedepth</code></li>
</ul></li>
<li>If you are only getting this warning and other diagnostics are good, likely safe to ignore (but you may lose out on efficiency)</li>
</ul>
</div>
<p><span class="footerRight">&lt;https://mc-stan.org/misc/warnings.html#bulk-and-tail-ess &gt;</span></p>
</section>
<section id="bayesian-fraction-of-missing-information-bfmi" class="slide level2">
<h2>Bayesian Fraction of Missing Information (BFMI)</h2>
<p>Example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>The E<span class="sc">-</span>BFMI <span class="fl">0.2786</span> is below the nominal threshold of <span class="fl">0.3</span> </span>
<span id="cb3-2"><a href="#cb3-2"></a>which suggests that HMC may have trouble exploring the target </span>
<span id="cb3-3"><a href="#cb3-3"></a>distribution.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>There is an <code>energy__</code> output from Stan’s samplers is used to diagnose the accuracy of HMC</li>
<li>Implication of this warning is that HMC is not exploring the posterior well, in particular the tails of the posterior
<ul>
<li>Run the model longer or reparameterize your model</li>
</ul></li>
<li>Mathematically dense (see Betancourt 2016) <span class="footerRight"><a href="https://arxiv.org/pdf/1604.00695.pdf" class="uri">https://arxiv.org/pdf/1604.00695.pdf</a></span></li>
</ul>
</section>
<section id="debugging-stan-code" class="slide level2">
<h2>Debugging Stan code</h2>
<ul>
<li>Stan provides <code>print()</code> statements that can print literal strings and the values of expressions</li>
<li><code>print()</code>: accepts any number of arguments</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb4-1"><a href="#cb4-1"></a><span class="cf">for</span> (n <span class="kw">in</span> <span class="dv">1</span><span class="op">:</span>N) { </span>
<span id="cb4-2"><a href="#cb4-2"></a>    <span class="fu">print</span>(<span class="st">"loop iteration: "</span><span class="op">,</span> n)<span class="op">;</span> <span class="op">...</span> </span>
<span id="cb4-3"><a href="#cb4-3"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Each time the loop body is executed, it will print the string “loop iteration:” (with the trailing space), followed by the value of the expression n, followed by a new line</li>
</ul>
<p><span class="footerRight"><a href="https://mc-stan.org/docs/reference-manual/print-statements.html" class="uri">https://mc-stan.org/docs/reference-manual/print-statements.html</a></span></p>
</section>
<section id="useful-things-to-do-with-print" class="slide level2">
<h2>Useful things to do with <code>print()</code></h2>
<ul>
<li>Very useful for debugging, particularly when coupled with <code>target()</code>
<ul>
<li><code>target()</code> is the log density accumulator, and is actually a reserved word in Stan</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource javascript number-lines code-with-copy"><code class="sourceCode javascript"><span id="cb5-1"><a href="#cb5-1"></a>vector[<span class="dv">2</span>] y<span class="op">;</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>y[<span class="dv">1</span>] <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="fu">print</span>(<span class="st">"log density before ="</span><span class="op">,</span> <span class="fu">target</span>())<span class="op">;</span></span>
<span id="cb5-4"><a href="#cb5-4"></a>y <span class="op">~</span> <span class="fu">normal</span>(<span class="dv">0</span><span class="op">,</span><span class="dv">1</span>)<span class="op">;</span>  <span class="co">// bug!  y[2] not defined</span></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="fu">print</span>(<span class="st">"log density after ="</span><span class="op">,</span> <span class="fu">target</span>())<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><span class="footerRight"><a href="https://mc-stan.org/docs/reference-manual/print-statements.html" class="uri">https://mc-stan.org/docs/reference-manual/print-statements.html</a></span></p>
</section>
<section id="debugging-r-code" class="slide level2">
<h2>Debugging R code</h2>
<ul>
<li>Ten minute warp-speed lesson on debugging in R</li>
<li>Several ways to do this, but here we’ll do a demo of the functions <code>traceback()</code> and <code>browser()</code></li>
</ul>
</section>
<section id="traceback" class="slide level2">
<h2><code>traceback()</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>foo <span class="ot">&lt;-</span> <span class="cf">function</span>(x) { <span class="fu">print</span>(<span class="dv">1</span>); <span class="fu">bar</span>(<span class="dv">2</span>) }</span>
<span id="cb6-2"><a href="#cb6-2"></a>bar <span class="ot">&lt;-</span> <span class="cf">function</span>(x) { x <span class="sc">+</span> a.variable.which.does.not.exist }</span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="co"># foo(2) # gives a strange error</span></span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="co"># Error in bar(2) : object 'a.variable.which.does.not.exist' not found</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="fu">traceback</span>()</span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="dv">2</span><span class="sc">:</span> <span class="fu">bar</span>(<span class="dv">2</span>) at <span class="co">#1</span></span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="dv">1</span><span class="sc">:</span> <span class="fu">foo</span>(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>identifies which function generated the error</li>
</ul>
</section>
<section id="browser" class="slide level2">
<h2><code>browser()</code></h2>
<ul>
<li>Abstract and not well implemented (Belinsky, pers comm 2023)</li>
<li>This is what I (Cahill) mainly use to debug R code</li>
<li>Interrupts the execution of an expression and allow the inspection of the environment where browser was called from</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>my_fx <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb8-2"><a href="#cb8-2"></a>    y <span class="ot">&lt;-</span> x<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb8-3"><a href="#cb8-3"></a>    z <span class="ot">&lt;-</span> y <span class="sc">-</span> x <span class="sc">+</span> <span class="dv">3</span></span>
<span id="cb8-4"><a href="#cb8-4"></a>    a <span class="ot">&lt;-</span> z <span class="sc">-</span> <span class="dv">1</span> <span class="sc">/</span> y</span>
<span id="cb8-5"><a href="#cb8-5"></a>    a</span>
<span id="cb8-6"><a href="#cb8-6"></a>}</span>
<span id="cb8-7"><a href="#cb8-7"></a></span>
<span id="cb8-8"><a href="#cb8-8"></a><span class="fu">my_fx</span>(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
</div>
</section>
<section id="browser-1" class="slide level2">
<h2><code>browser()</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># demonstrate some weird behavior:</span></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="fu">my_fx</span>(<span class="cn">NA</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="fu">my_fx</span>(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8.888889</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="fu">my_fx</span>(<span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -Inf</code></pre>
</div>
</div>
<ul>
<li>Put a <code>browser()</code> in it to win it</li>
</ul>
<p><span class="footerRight"><a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/browser.html" class="uri">https://stat.ethz.ch/R-manual/R-devel/library/base/html/browser.html</a></span></p>
</section>
<section id="browser-2" class="slide level2">
<h2><code>browser()</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>my_fx <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb16-2"><a href="#cb16-2"></a>    <span class="fu">browser</span>() <span class="co"># slap a browser in it</span></span>
<span id="cb16-3"><a href="#cb16-3"></a>    y <span class="ot">&lt;-</span> x<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb16-4"><a href="#cb16-4"></a>    z <span class="ot">&lt;-</span> y <span class="sc">-</span> x <span class="sc">+</span> <span class="dv">3</span></span>
<span id="cb16-5"><a href="#cb16-5"></a>    a <span class="ot">&lt;-</span> z <span class="sc">-</span> <span class="dv">1</span> <span class="sc">/</span> y</span>
<span id="cb16-6"><a href="#cb16-6"></a>    a</span>
<span id="cb16-7"><a href="#cb16-7"></a>}</span>
<span id="cb16-8"><a href="#cb16-8"></a></span>
<span id="cb16-9"><a href="#cb16-9"></a><span class="fu">my_fx</span>(<span class="dv">0</span>) <span class="co"># call the function</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Go to R to demonstrate how to use</li>
<li>Note this works with for-loops and other horrid things</li>
</ul>
</section>
<section id="summary-and-outlook" class="slide level2">
<h2>Summary and outlook</h2>
<ul>
<li>Went through some common Stan runtime warnings and error messages
<ul>
<li>Discussed that some checks are about the validity of inferences while others are about efficiency</li>
</ul></li>
<li>Debugging Stan code via <code>print()</code> statements</li>
<li>Debugging R code via <code>traceback()</code> and <code>browser()</code></li>
<li>Next few weeks, move into nonlinear and mixed effects modeling (where we will experience some of these warnings/issues)</li>
</ul>
</section>
<section id="references" class="slide level2">
<h2>References</h2>
<div style="font-size:25px">
<p>Betancourt, M. 2016. Diagnosing suboptimal cotangent disintegrations in Hamiltonian Monte Carlo. <a href="https://arxiv.org/pdf/1604.00695.pdf" class="uri">https://arxiv.org/pdf/1604.00695.pdf</a></p>
<p>Gelman et al.&nbsp;2003. Bayesian Data Analysis.</p>
<p>McElreath 2023. Statistical Rethinking. Second Edition.</p>
<p>Stan documentation. 2023. <a href="https://mc-stan.org/docs/reference-manual/index.html" class="uri">https://mc-stan.org/docs/reference-manual/index.html</a></p>
</div>
<div class="footer footer-default">

</div>
</section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="lec5_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="lec5_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="lec5_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="lec5_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="lec5_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="lec5_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="lec5_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="lec5_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="lec5_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="lec5_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        text: function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>